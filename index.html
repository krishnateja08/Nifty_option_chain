<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nifty 50 Daily Report</title>
    <link href="https://fonts.googleapis.com/css2?family=Oxanium:wght@400;600;700;800&family=Rajdhani:wght@400;500;600;700&family=JetBrains+Mono:wght@400;600;700&family=Outfit:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;}
        html{scroll-behavior:smooth;}
        body{font-family:'Rajdhani',sans-serif;background:linear-gradient(135deg,#0f2027 0%,#203a43 50%,#2c5364 100%);min-height:100vh;padding:clamp(8px,2vw,24px);color:#b0bec5;overflow-x:hidden;-webkit-text-size-adjust:100%;}

        .tab-nav{display:flex;gap:0;border-bottom:2px solid rgba(79,195,247,0.2);overflow-x:auto;scrollbar-width:none;background:linear-gradient(135deg,#0f2027,#203a43);}
        .tab-nav::-webkit-scrollbar{display:none;}
        .tab-btn{display:flex;align-items:center;gap:8px;padding:13px clamp(14px,2.5vw,28px);font-family:'Oxanium',sans-serif;font-size:clamp(10px,1.4vw,13px);font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:rgba(176,190,197,0.5);cursor:pointer;border:none;background:transparent;border-bottom:3px solid transparent;white-space:nowrap;transition:all 0.25s ease;position:relative;bottom:-2px;}
        .tab-btn:hover{color:#4fc3f7;background:rgba(79,195,247,0.05);}
        .tab-btn.active{color:#4fc3f7;border-bottom-color:#4fc3f7;background:rgba(79,195,247,0.08);}
        .tab-dot{width:7px;height:7px;border-radius:50%;background:rgba(79,195,247,0.3);flex-shrink:0;transition:all 0.25s ease;}
        .tab-btn.active .tab-dot{background:#4fc3f7;box-shadow:0 0 8px #4fc3f7;}
        .tab-badge{font-size:9px;padding:2px 7px;border-radius:10px;background:rgba(79,195,247,0.12);border:1px solid rgba(79,195,247,0.25);color:#4fc3f7;}
        .new-badge .tab-badge{background:rgba(0,230,118,0.12);border-color:rgba(0,230,118,0.3);color:#00e676;}
        .tab-panel{display:none;}
        .tab-panel.active{display:block;}

        .container{max-width:1600px;margin:0 auto;background:rgba(15,32,39,0.85);backdrop-filter:blur(20px);border-radius:clamp(12px,2vw,20px);overflow:hidden;box-shadow:0 20px 60px rgba(0,0,0,0.5);border:1px solid rgba(79,195,247,0.18);min-width:0;}
        .header{background:linear-gradient(135deg,#0f2027,#203a43);padding:clamp(16px,3vw,32px) clamp(14px,3vw,30px) 0;text-align:center;position:relative;overflow:hidden;}
        .header::before{content:'';position:absolute;inset:0;background:radial-gradient(circle at 50% 50%,rgba(79,195,247,0.08) 0%,transparent 70%);pointer-events:none;}
        .header h1{font-family:'Oxanium',sans-serif;font-size:clamp(16px,3.5vw,30px);font-weight:800;color:#4fc3f7;text-shadow:0 0 30px rgba(79,195,247,0.5);letter-spacing:clamp(0.5px,0.3vw,2px);position:relative;z-index:1;word-break:break-word;margin-bottom:clamp(10px,2vw,18px);}
        .status-bar{display:flex;align-items:center;justify-content:center;flex-wrap:wrap;gap:0;background:rgba(0,0,0,0.30);border:1px solid rgba(79,195,247,0.15);border-radius:10px;padding:0;overflow:hidden;position:relative;z-index:1;box-shadow:inset 0 1px 0 rgba(79,195,247,0.12);margin-bottom:16px;}
        .sb-item{display:flex;align-items:center;gap:8px;padding:10px clamp(10px,2vw,20px);flex:1 1 auto;min-width:0;border-right:1px solid rgba(79,195,247,0.10);white-space:nowrap;}
        .sb-item:last-child{border-right:none;}
        .sb-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;}
        .sb-dot-gen{background:#00e676;box-shadow:0 0 8px #00e676;}
        .sb-dot-clock{background:#4fc3f7;box-shadow:0 0 8px #4fc3f7;}
        .sb-dot-updated{background:#ffb74d;box-shadow:0 0 8px #ffb74d;animation:sb-pulse 2s ease-in-out infinite;}
        .sb-dot-cd{background:#b388ff;box-shadow:0 0 8px #b388ff;}
        @keyframes sb-pulse{50%{opacity:0.2;}}
        .sb-label{font-family:'JetBrains Mono',monospace;font-size:clamp(8px,1vw,9px);letter-spacing:1.8px;text-transform:uppercase;color:rgba(128,222,234,0.40);flex-shrink:0;}
        .sb-value{font-family:'JetBrains Mono',monospace;font-size:clamp(10px,1.3vw,12px);font-weight:700;color:#e0f7fa;overflow:hidden;text-overflow:ellipsis;}
        .sb-value.gen-val{color:#80deea;} .sb-value.clock-val{color:#4fc3f7;font-size:clamp(11px,1.5vw,13px);} .sb-value.updated-val{color:#ffb74d;} .sb-value.cd-val{color:#b388ff;min-width:28px;}

        .section{padding:clamp(14px,2.5vw,28px) clamp(12px,2.5vw,26px);border-bottom:1px solid rgba(79,195,247,0.08);}
        .section:last-child{border-bottom:none;}
        .section-title{font-family:'Oxanium',sans-serif;font-size:clamp(10px,1.5vw,13px);font-weight:700;letter-spacing:clamp(1px,0.3vw,2.5px);color:#4fc3f7;text-transform:uppercase;display:flex;align-items:center;gap:10px;margin-bottom:clamp(12px,2vw,20px);padding-bottom:12px;border-bottom:1px solid rgba(79,195,247,0.18);flex-wrap:wrap;}
        .section-title span{font-size:clamp(14px,2vw,18px);}

        .g{background:rgba(255,255,255,0.04);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid rgba(79,195,247,0.18);border-radius:16px;position:relative;overflow:hidden;transition:all 0.35s cubic-bezier(0.4,0,0.2,1);min-width:0;}
        .g::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.25),transparent);z-index:1;}
        .g::after{content:'';position:absolute;top:-60%;left:-30%;width:50%;height:200%;background:linear-gradient(105deg,transparent,rgba(255,255,255,0.04),transparent);transform:skewX(-15deg);transition:left 0.6s ease;z-index:0;}
        .g:hover::after{left:130%;}
        .g:hover{background:rgba(79,195,247,0.09);border-color:rgba(79,195,247,0.45);box-shadow:0 12px 40px rgba(0,0,0,0.35),inset 0 1px 0 rgba(255,255,255,0.1);transform:translateY(-4px);}
        .g-hi{background:rgba(79,195,247,0.09);border-color:rgba(79,195,247,0.35);}
        .g-red{background:rgba(244,67,54,0.06);border-color:rgba(244,67,54,0.25);}
        .g-red:hover{background:rgba(244,67,54,0.1);border-color:rgba(244,67,54,0.45);}
        .card-grid{display:grid;gap:14px;}
        .grid-5{grid-template-columns:repeat(5,minmax(0,1fr));}
        .grid-4{grid-template-columns:repeat(4,minmax(0,1fr));}
        .g .card-top-row{display:flex;align-items:center;gap:10px;margin-bottom:10px;position:relative;z-index:2;padding:14px 16px 0;}
        .card-ico{font-size:clamp(16px,2vw,22px);line-height:1;flex-shrink:0;}
        .lbl{font-size:clamp(8px,1vw,9px);letter-spacing:2.5px;color:rgba(128,222,234,0.65);text-transform:uppercase;font-weight:600;line-height:1.3;word-break:break-word;}
        .val{font-family:'Oxanium',sans-serif;font-size:clamp(16px,2.5vw,24px);font-weight:700;color:#fff;display:block;margin-bottom:10px;position:relative;z-index:2;padding:0 16px;word-break:break-word;overflow:hidden;text-overflow:ellipsis;}
        .bar-wrap{height:5px;background:rgba(0,0,0,0.35);border-radius:3px;margin:0 16px 12px;overflow:hidden;position:relative;z-index:2;}
        .bar-fill{height:100%;border-radius:3px;transition:width 1.2s cubic-bezier(0.4,0,0.2,1);}
        .bar-teal{background:linear-gradient(90deg,#00bcd4,#4fc3f7);box-shadow:0 0 8px rgba(79,195,247,0.6);}
        .bar-red{background:linear-gradient(90deg,#f44336,#ff5722);box-shadow:0 0 8px rgba(244,67,54,0.5);}
        .bar-gold{background:linear-gradient(90deg,#ffb74d,#ffd54f);box-shadow:0 0 8px rgba(255,183,77,0.5);}
        .card-foot{display:flex;justify-content:space-between;align-items:center;padding:0 16px 14px;position:relative;z-index:2;flex-wrap:wrap;gap:4px;}
        .sub{font-size:10px;color:#455a64;font-family:'JetBrains Mono',monospace;}
        .tag{display:inline-flex;align-items:center;padding:3px 11px;border-radius:20px;font-size:clamp(9px,1.2vw,11px);font-weight:700;letter-spacing:0.5px;font-family:'Rajdhani',sans-serif;white-space:nowrap;}
        .tag-neu{background:rgba(255,183,77,0.15);color:#ffb74d;border:1px solid rgba(255,183,77,0.35);}
        .tag-bull{background:rgba(0,229,255,0.12);color:#00e5ff;border:1px solid rgba(0,229,255,0.35);}
        .tag-bear{background:rgba(255,82,82,0.12);color:#ff5252;border:1px solid rgba(255,82,82,0.35);}

        .snap-grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:14px;}
        .snap-card{padding:18px 16px;}
        .snap-card .card-top-row{margin-bottom:8px;padding:0;}
        .snap-card .val{font-size:clamp(18px,3vw,26px);padding:0;margin-bottom:0;}

        .md-widget{position:relative;overflow:hidden;background:linear-gradient(135deg,rgba(255,255,255,0.07),rgba(255,255,255,0.02));border:1px solid rgba(255,255,255,0.1);border-radius:16px;padding:clamp(12px,2vw,16px) clamp(14px,2vw,20px);backdrop-filter:blur(20px);display:flex;flex-direction:column;gap:12px;}
        .md-glow{position:absolute;top:-80%;left:-80%;width:260%;height:260%;background:conic-gradient(from 180deg,#ff6b35 0deg,#ffcd3c 120deg,#4ecdc4 240deg,#ff6b35 360deg);opacity:0.05;animation:md-rotate 8s linear infinite;border-radius:50%;pointer-events:none;}
        @keyframes md-rotate{to{transform:rotate(360deg);}}
        .md-row-top{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;position:relative;z-index:1;}
        .md-label{display:flex;align-items:center;gap:7px;font-family:'Space Mono',monospace;font-size:clamp(7px,1vw,8px);letter-spacing:3px;color:rgba(255,255,255,0.3);text-transform:uppercase;}
        .md-live-dot{width:6px;height:6px;border-radius:50%;background:#4ecdc4;box-shadow:0 0 8px #4ecdc4;animation:md-pulse 2s ease-in-out infinite;flex-shrink:0;}
        @keyframes md-pulse{50%{opacity:0.25;}}
        .md-pills-top{display:flex;gap:8px;flex-wrap:wrap;}
        .md-pill{font-family:'Space Mono',monospace;font-size:clamp(8px,1.2vw,10px);font-weight:700;padding:4px clamp(8px,1.5vw,14px);border-radius:20px;letter-spacing:1px;white-space:nowrap;}
        .md-pill-bull{background:rgba(78,205,196,0.12);border:1px solid rgba(78,205,196,0.4);color:#4ecdc4;}
        .md-pill-bear{background:rgba(255,100,100,0.12);border:1px solid rgba(255,100,100,0.4);color:#ff6b6b;}
        .md-pill-conf-high{background:rgba(78,205,196,0.12);border:1px solid rgba(78,205,196,0.35);color:#4ecdc4;}
        .md-pill-conf-med{background:rgba(255,205,60,0.12);border:1px solid rgba(255,205,60,0.35);color:#ffcd3c;}
        .md-pill-conf-low{background:rgba(255,107,107,0.12);border:1px solid rgba(255,107,107,0.35);color:#ff6b6b;}
        .md-row-bottom{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;position:relative;z-index:1;}
        .md-direction{font-family:'Orbitron',monospace;font-weight:900;font-size:clamp(22px,5vw,36px);letter-spacing:clamp(1px,0.5vw,3px);line-height:1;}

        .logic-box{background:rgba(79,195,247,0.04);border:1px solid rgba(79,195,247,0.14);border-left:3px solid #4fc3f7;border-radius:10px;padding:10px 16px;margin-top:12px;}
        .logic-box-head{font-family:'Oxanium',sans-serif;font-size:10px;font-weight:700;color:#4fc3f7;letter-spacing:2px;margin-bottom:7px;}
        .logic-grid{display:grid;grid-template-columns:1fr 1fr;gap:5px 20px;}
        .logic-item{display:flex;align-items:center;gap:7px;font-size:clamp(10px,1.3vw,11px);color:rgba(176,190,197,0.6);flex-wrap:wrap;}
        .logic-item .lv{font-family:'JetBrains Mono',monospace;font-size:10px;color:rgba(176,190,197,0.4);}
        .lc-bull{display:inline-flex;align-items:center;font-family:'JetBrains Mono',monospace;font-size:9px;font-weight:600;padding:2px 8px;border-radius:4px;white-space:nowrap;background:rgba(0,230,118,0.1);color:#00e676;border:1px solid rgba(0,230,118,0.28);}
        .lc-bear{display:inline-flex;align-items:center;font-family:'JetBrains Mono',monospace;font-size:9px;font-weight:600;padding:2px 8px;border-radius:4px;white-space:nowrap;background:rgba(255,82,82,0.1);color:#ff5252;border:1px solid rgba(255,82,82,0.28);}
        .lc-side{display:inline-flex;align-items:center;font-family:'JetBrains Mono',monospace;font-size:9px;font-weight:600;padding:2px 8px;border-radius:4px;white-space:nowrap;background:rgba(255,183,77,0.1);color:#ffb74d;border:1px solid rgba(255,183,77,0.28);}
        .lc-info{display:inline-flex;align-items:center;font-family:'JetBrains Mono',monospace;font-size:9px;font-weight:600;padding:2px 8px;border-radius:4px;white-space:nowrap;background:rgba(79,195,247,0.08);color:#4fc3f7;border:1px solid rgba(79,195,247,0.22);}

        .rl-node-a{position:absolute;bottom:0;transform:translateX(-50%);text-align:center;}
        .rl-node-b{position:absolute;top:0;transform:translateX(-50%);text-align:center;}
        .rl-dot{width:12px;height:12px;border-radius:50%;border:2px solid rgba(10,20,35,0.9);}
        .rl-lbl{font-size:clamp(7px,1vw,10px);font-weight:700;text-transform:uppercase;letter-spacing:0.4px;line-height:1.3;white-space:nowrap;color:#b0bec5;}
        .rl-val{font-size:clamp(9px,1.3vw,13px);font-weight:700;color:#fff;white-space:nowrap;margin-top:2px;}
        /* Mobile key levels: hide absolute labels, show compact table instead */
        .kl-mobile-table{display:none;width:100%;border-collapse:collapse;font-family:'JetBrains Mono',monospace;font-size:11px;margin-top:10px;}
        .kl-mobile-table td{padding:6px 10px;border-bottom:1px solid rgba(79,195,247,0.08);}
        .kl-mobile-table td:last-child{text-align:right;font-weight:700;}
        .kl-bar-section{display:block;}
        @media(max-width:520px){
            .kl-bar-section{display:none;}
            .kl-mobile-table{display:table;}
        }

        .pf-live-badge{display:inline-block;padding:2px 10px;border-radius:10px;font-size:10px;font-weight:700;letter-spacing:1px;}
        .pf-live{background:rgba(0,230,118,0.1);color:#00e676;border:1px solid rgba(0,230,118,0.3);}
        .pf-estimated{background:rgba(255,138,101,0.1);color:#ff8a65;border:1px solid rgba(255,138,101,0.3);}
        .pf-date-range{font-size:11px;color:#80deea;font-weight:400;letter-spacing:1px;}
        .pf-grid{display:grid;grid-template-columns:repeat(5,minmax(0,1fr));gap:14px;margin-bottom:18px;}
        .pf-card{background:rgba(255,255,255,0.03);border:1px solid rgba(0,212,255,0.18);border-radius:16px;padding:16px 14px 14px;display:flex;flex-direction:column;gap:12px;position:relative;overflow:hidden;transition:all 0.25s cubic-bezier(0.4,0,0.2,1);min-width:0;}
        .pf-card:hover{background:rgba(255,255,255,0.06);transform:translateY(-3px);box-shadow:0 12px 32px rgba(0,0,0,0.35);}
        .pf-card-topline{position:absolute;top:0;left:0;right:0;height:1px;}
        .pf-card-head{display:flex;justify-content:space-between;align-items:baseline;}
        .pf-card-date{font-family:'Oxanium',sans-serif;font-size:clamp(10px,1.5vw,12px);font-weight:700;color:#e0f7fa;letter-spacing:1px;}
        .pf-card-day{font-size:9px;letter-spacing:1.5px;color:rgba(128,222,234,0.3);text-transform:uppercase;}
        .pf-block{display:flex;flex-direction:column;gap:5px;}
        .pf-block-header{display:flex;justify-content:space-between;align-items:baseline;}
        .pf-block-lbl{font-size:8px;font-weight:700;letter-spacing:2px;text-transform:uppercase;}
        .pf-fii-lbl{color:rgba(0,212,255,0.5);} .pf-dii-lbl{color:rgba(255,179,0,0.5);}
        .pf-block-val{font-family:'JetBrains Mono',monospace;font-size:clamp(12px,1.8vw,15px);font-weight:700;line-height:1;word-break:break-all;}
        .pf-bar-track{height:4px;background:rgba(0,0,0,0.35);border-radius:2px;overflow:hidden;}
        .pf-bar-fill{height:100%;border-radius:2px;transition:width 1.2s cubic-bezier(0.4,0,0.2,1);}
        .pf-divider{height:1px;background:rgba(255,255,255,0.04);margin:0 -2px;}
        .pf-card-net{display:flex;justify-content:space-between;align-items:baseline;padding-top:8px;border-top:1px solid rgba(255,255,255,0.05);margin-top:auto;}
        .pf-net-lbl{font-size:8px;letter-spacing:2px;color:rgba(255,255,255,0.2);text-transform:uppercase;font-weight:700;}
        .pf-net-val{font-family:'JetBrains Mono',monospace;font-size:clamp(11px,1.5vw,13px);font-weight:700;word-break:break-all;}
        .pf-avg-strip{display:grid;grid-template-columns:1fr auto 1fr auto 1fr;align-items:center;background:rgba(6,13,20,0.75);border:1px solid rgba(79,195,247,0.1);border-radius:14px;padding:18px 24px;margin-bottom:16px;}
        .pf-avg-cell{text-align:center;min-width:0;}
        .pf-avg-eyebrow{font-size:8px;letter-spacing:2.5px;color:rgba(0,229,255,0.4);text-transform:uppercase;margin-bottom:6px;font-weight:700;}
        .pf-avg-val{font-family:'Oxanium',sans-serif;font-size:clamp(18px,3vw,26px);font-weight:800;line-height:1;letter-spacing:-0.5px;word-break:break-word;}
        .pf-avg-unit{font-size:9px;color:#37474f;margin-top:3px;letter-spacing:1px;}
        .pf-avg-sep{width:1px;height:48px;background:linear-gradient(180deg,transparent,rgba(79,195,247,0.2),transparent);margin:0 16px;flex-shrink:0;}
        .pf-insight-box{border-radius:12px;padding:16px 18px;}
        .pf-insight-header{display:flex;align-items:center;gap:10px;margin-bottom:10px;flex-wrap:wrap;}
        .pf-insight-lbl{font-size:9px;letter-spacing:2px;font-weight:700;text-transform:uppercase;}
        .pf-verdict-badge{display:inline-block;padding:3px 14px;border-radius:20px;font-size:clamp(10px,1.5vw,11px);font-weight:800;letter-spacing:1px;white-space:nowrap;}
        .pf-insight-text{font-size:clamp(12px,1.5vw,13px);color:#cfd8dc;line-height:1.85;font-weight:500;}

        .nc-section-header{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;margin-bottom:18px;padding-bottom:14px;border-bottom:1px solid rgba(79,195,247,0.14);}
        .nc-header-left{display:flex;align-items:center;gap:14px;}
        .nc-header-icon{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,#1e3a5f,#1a3052);border:1px solid rgba(79,195,247,0.3);display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;box-shadow:0 4px 14px rgba(79,195,247,0.15);}
        .nc-header-title{font-family:'Outfit',sans-serif;font-size:clamp(13px,2vw,17px);font-weight:700;color:#93c5fd;letter-spacing:0.3px;}
        .nc-header-sub{font-family:'Outfit',sans-serif;font-size:11px;font-weight:400;color:rgba(79,195,247,0.45);margin-top:2px;letter-spacing:0.5px;}
        .nc-atm-badge{background:#1f2a42;color:#60a5fa;font-family:'Outfit',sans-serif;font-size:12px;font-weight:700;padding:6px 16px;border-radius:20px;letter-spacing:1.5px;border:1px solid rgba(96,165,250,0.25);box-shadow:0 2px 10px rgba(96,165,250,0.1);white-space:nowrap;}
        .nc-dir-box{border-radius:14px;padding:clamp(14px,2vw,20px) clamp(14px,2vw,22px);margin-bottom:18px;box-shadow:0 4px 24px rgba(0,0,0,0.3);}
        .nc-dir-bar{width:4px;border-radius:2px;flex-shrink:0;min-height:60px;}
        .nc-dir-tag{font-family:'Outfit',sans-serif;font-size:9px;font-weight:700;letter-spacing:2.5px;color:rgba(148,163,184,0.5);text-transform:uppercase;margin-bottom:6px;}
        .nc-dir-name{font-family:'Outfit',sans-serif;font-size:clamp(18px,3vw,28px);font-weight:700;line-height:1;margin-bottom:6px;letter-spacing:-0.5px;}
        .nc-dir-signal{font-family:'Outfit',sans-serif;font-size:clamp(10px,1.3vw,12px);font-weight:400;}
        .nc-meters-panel{display:flex;flex-direction:column;gap:14px;min-width:180px;justify-content:center;}
        .nc-meter-row{display:flex;flex-direction:column;gap:5px;}
        .nc-meter-head-row{display:flex;justify-content:space-between;align-items:center;}
        .nc-meter-label{font-family:'Outfit',sans-serif;font-size:9px;font-weight:700;letter-spacing:2px;color:rgba(148,163,184,0.45);text-transform:uppercase;}
        .nc-meter-track{position:relative;height:8px;background:rgba(0,0,0,0.4);border-radius:4px;overflow:visible;width:clamp(120px,20vw,200px);}
        .nc-meter-fill{height:100%;border-radius:4px;}
        .nc-meter-head{position:absolute;top:50%;transform:translate(-50%,-50%);width:14px;height:14px;border-radius:50%;border:2px solid rgba(10,18,30,0.85);}
        .nc-meter-pct{font-family:'Oxanium',sans-serif;font-size:clamp(12px,1.8vw,15px);font-weight:700;letter-spacing:0.5px;}
        .nc-cards-grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:14px;}
        .nc-card{background:rgba(20,28,45,0.85);border:1px solid rgba(79,195,247,0.12);border-radius:14px;padding:clamp(12px,2vw,18px) clamp(12px,2vw,18px) 14px;transition:all 0.3s ease;position:relative;overflow:hidden;min-width:0;}
        .nc-card::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.1),transparent);}
        .nc-card:hover{border-color:rgba(79,195,247,0.3);background:rgba(25,35,55,0.9);transform:translateY(-3px);box-shadow:0 10px 30px rgba(0,0,0,0.3);}
        .nc-card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;flex-wrap:wrap;gap:4px;}
        .nc-card-label{font-family:'Outfit',sans-serif;font-size:clamp(8px,1.2vw,10px);font-weight:700;letter-spacing:2px;color:rgba(148,163,184,0.6);text-transform:uppercase;}
        .nc-card-value{font-family:'Oxanium',sans-serif;font-size:clamp(20px,3.5vw,30px);font-weight:700;line-height:1;margin-bottom:6px;letter-spacing:-0.5px;word-break:break-word;}
        .nc-card-sub{font-family:'JetBrains Mono',monospace;font-size:10px;color:rgba(100,116,139,0.7);margin-bottom:14px;}
        .nc-card-btn{display:block;width:100%;padding:9px 14px;border-radius:7px;text-align:center;font-family:'Outfit',sans-serif;font-size:clamp(11px,1.5vw,13px);font-weight:700;letter-spacing:0.5px;cursor:default;}

        .annot-badge{font-size:9px;padding:2px 10px;border-radius:8px;background:rgba(0,230,118,0.1);border:1px solid rgba(0,230,118,0.25);color:#00e676;font-family:'JetBrains Mono',monospace;letter-spacing:1px;font-weight:700;white-space:nowrap;}
        .input-summary-grid{display:grid;grid-template-columns:repeat(5,minmax(0,1fr));gap:12px;margin-bottom:20px;}
        .inp-summary-card{border-radius:12px;padding:14px 16px;border:1px solid;transition:all 0.2s ease;}
        .inp-auto-card{background:rgba(0,230,118,0.04);border-color:rgba(0,230,118,0.2);}
        .inp-manual-card{background:rgba(79,195,247,0.04);border-color:rgba(79,195,247,0.15);}
        .inp-s-label{font-size:9px;letter-spacing:2px;text-transform:uppercase;font-weight:700;margin-bottom:6px;}
        .inp-auto-card .inp-s-label{color:rgba(0,230,118,0.5);}
        .inp-manual-card .inp-s-label{color:rgba(79,195,247,0.5);}
        .inp-s-val{font-family:'Oxanium',sans-serif;font-size:clamp(14px,2vw,18px);font-weight:700;color:#e0f7fa;margin-bottom:4px;line-height:1.2;}
        .inp-s-src{font-size:9px;font-family:'JetBrains Mono',monospace;}
        .inp-auto-card .inp-s-src{color:rgba(0,230,118,0.3);}
        .inp-manual-card .inp-s-src{color:rgba(79,195,247,0.3);}
        .na-inline{color:rgba(176,190,197,0.3);font-family:'JetBrains Mono',monospace;font-size:13px;}
        .signal-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;margin-bottom:20px;}
        .sig-card{background:rgba(255,255,255,0.03);border:1px solid rgba(79,195,247,0.12);border-radius:12px;padding:14px 16px;display:flex;align-items:flex-start;gap:14px;}
        .sig-icon{width:38px;height:38px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;}
        .sig-bull{background:rgba(0,230,118,0.1);border:1px solid rgba(0,230,118,0.25);}
        .sig-bear{background:rgba(255,82,82,0.1);border:1px solid rgba(255,82,82,0.25);}
        .sig-neu{background:rgba(255,183,77,0.1);border:1px solid rgba(255,183,77,0.25);}
        .sig-na{background:rgba(176,190,197,0.06);border:1px solid rgba(176,190,197,0.12);}
        .sig-body{flex:1;min-width:0;}
        .sig-name{font-size:9px;letter-spacing:1.5px;color:rgba(128,222,234,0.5);text-transform:uppercase;font-weight:700;margin-bottom:4px;display:flex;align-items:center;gap:6px;flex-wrap:wrap;}
        .sig-val{font-family:'Oxanium',sans-serif;font-size:15px;font-weight:700;color:#fff;margin-bottom:3px;}
        .sig-val.na-val{color:rgba(176,190,197,0.3);font-family:'JetBrains Mono',monospace;font-size:13px;}
        .sig-msg{font-size:11px;color:rgba(176,190,197,0.55);line-height:1.5;}
        .sig-score{font-family:'JetBrains Mono',monospace;font-size:13px;font-weight:700;padding:3px 9px;border-radius:6px;flex-shrink:0;margin-top:2px;}
        .score-p{background:rgba(0,230,118,0.12);color:#00e676;border:1px solid rgba(0,230,118,0.3);}
        .score-n{background:rgba(255,82,82,0.12);color:#ff5252;border:1px solid rgba(255,82,82,0.3);}
        .score-0{background:rgba(255,183,77,0.1);color:#ffb74d;border:1px solid rgba(255,183,77,0.25);}
        .score-na{background:rgba(176,190,197,0.08);color:rgba(176,190,197,0.35);border:1px solid rgba(176,190,197,0.12);}
        .auto-badge{font-size:8px;padding:1px 6px;border-radius:4px;background:rgba(0,230,118,0.1);border:1px solid rgba(0,230,118,0.25);color:#00e676;font-weight:700;letter-spacing:0.5px;}
        .manual-badge{font-size:8px;padding:1px 6px;border-radius:4px;background:rgba(79,195,247,0.08);border:1px solid rgba(79,195,247,0.2);color:#4fc3f7;font-weight:700;letter-spacing:0.5px;}
        .score-meter{background:rgba(10,20,30,0.7);border:1px solid rgba(79,195,247,0.15);border-radius:16px;padding:22px 24px;display:flex;align-items:center;gap:24px;flex-wrap:wrap;}
        .score-ring-wrap{position:relative;flex-shrink:0;width:120px;height:120px;}
        .score-ring-label{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;}
        .score-ring-num{font-family:'Orbitron',monospace;font-size:26px;font-weight:900;line-height:1;}
        .score-ring-txt{font-size:8px;letter-spacing:2px;color:rgba(176,190,197,0.4);text-transform:uppercase;}
        .score-detail{flex:1;min-width:200px;}
        .score-bias-lbl{font-family:'Orbitron',monospace;font-size:clamp(16px,3vw,24px);font-weight:900;letter-spacing:2px;margin-bottom:8px;}
        .score-sub{font-size:12px;color:rgba(176,190,197,0.5);line-height:1.6;margin-bottom:8px;}
        .score-pills{display:flex;gap:8px;flex-wrap:wrap;}
        .sc-pill{font-family:'JetBrains Mono',monospace;font-size:10px;font-weight:700;padding:4px 12px;border-radius:20px;letter-spacing:1px;}
        .sc-pill-bull{background:rgba(0,230,118,0.1);border:1px solid rgba(0,230,118,0.3);color:#00e676;}
        .sc-pill-bear{background:rgba(255,82,82,0.1);border:1px solid rgba(255,82,82,0.3);color:#ff5252;}
        .sc-pill-neu{background:rgba(255,183,77,0.1);border:1px solid rgba(255,183,77,0.3);color:#ffb74d;}
        .sc-pill-na{background:rgba(176,190,197,0.06);border:1px solid rgba(176,190,197,0.15);color:rgba(176,190,197,0.4);}
        .strat-grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px;}
        .strat-card{background:rgba(255,255,255,0.03);border:1px solid rgba(79,195,247,0.12);border-radius:14px;padding:16px;position:relative;overflow:hidden;transition:all 0.25s ease;}
        .strat-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;}
        .strat-bull::before{background:linear-gradient(90deg,transparent,#00e676,transparent);}
        .strat-bear::before{background:linear-gradient(90deg,transparent,#ff5252,transparent);}
        .strat-neu::before{background:linear-gradient(90deg,transparent,#ffb74d,transparent);}
        .strat-vol::before{background:linear-gradient(90deg,transparent,#7c4dff,transparent);}
        .strat-misc::before{background:linear-gradient(90deg,transparent,#4fc3f7,transparent);}
        .strat-card:hover{transform:translateY(-3px);box-shadow:0 12px 30px rgba(0,0,0,0.3);border-color:rgba(79,195,247,0.3);}
        .strat-num{font-family:'JetBrains Mono',monospace;font-size:9px;color:rgba(176,190,197,0.25);margin-bottom:6px;letter-spacing:1px;}
        .strat-name{font-family:'Oxanium',sans-serif;font-size:clamp(12px,1.5vw,15px);font-weight:700;color:#e0f7fa;margin-bottom:8px;line-height:1.3;}
        .strat-tag{display:inline-flex;align-items:center;gap:5px;padding:3px 10px;border-radius:20px;font-size:9px;font-weight:700;letter-spacing:1px;}
        .strat-tag-bull{background:rgba(0,230,118,0.1);border:1px solid rgba(0,230,118,0.25);color:#00e676;}
        .strat-tag-bear{background:rgba(255,82,82,0.1);border:1px solid rgba(255,82,82,0.25);color:#ff5252;}
        .strat-tag-neu{background:rgba(255,183,77,0.1);border:1px solid rgba(255,183,77,0.25);color:#ffb74d;}
        .strat-tag-vol{background:rgba(124,77,255,0.1);border:1px solid rgba(124,77,255,0.25);color:#b388ff;}
        .strat-tag-misc{background:rgba(79,195,247,0.1);border:1px solid rgba(79,195,247,0.25);color:#4fc3f7;}
        .filter-btn{padding:6px 14px;border-radius:20px;font-size:10px;font-weight:700;letter-spacing:1px;cursor:pointer;border:1px solid rgba(79,195,247,0.2);background:transparent;color:rgba(176,190,197,0.5);transition:all 0.2s ease;font-family:'Oxanium',sans-serif;}
        .filter-btn.active,.filter-btn:hover{background:rgba(79,195,247,0.1);border-color:rgba(79,195,247,0.4);color:#4fc3f7;}

        .oi-controls{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px;margin-bottom:20px;}
        .oi-interval-btns{display:flex;gap:0;border:1px solid rgba(79,195,247,0.25);border-radius:10px;overflow:hidden;}
        .oi-int-btn{padding:9px 24px;font-family:'Oxanium',sans-serif;font-size:12px;font-weight:700;letter-spacing:2px;color:rgba(176,190,197,0.5);background:transparent;border:none;cursor:pointer;transition:all 0.2s ease;border-right:1px solid rgba(79,195,247,0.15);}
        .oi-int-btn:last-child{border-right:none;}
        .oi-int-btn:hover{background:rgba(79,195,247,0.12);color:#4fc3f7;}
        .oi-int-btn.active{background:rgba(79,195,247,0.22);color:#00e5ff;box-shadow:inset 0 0 12px rgba(79,195,247,0.1);}
        .oi-live-badge{display:flex;align-items:center;gap:7px;font-family:'JetBrains Mono',monospace;font-size:10px;letter-spacing:2px;color:rgba(0,230,118,0.7);background:rgba(0,230,118,0.08);border:1px solid rgba(0,230,118,0.25);padding:6px 14px;border-radius:8px;}
        .oi-live-dot{width:7px;height:7px;border-radius:50%;background:#00e676;box-shadow:0 0 8px #00e676;animation:sb-pulse 1.5s ease-in-out infinite;}
        .oi-summary-strip{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:12px;margin-bottom:20px;}
        .oi-sum-card{background:rgba(255,255,255,0.03);border:1px solid rgba(79,195,247,0.14);border-radius:12px;padding:14px 16px;text-align:center;}
        .oi-sum-label{font-size:9px;letter-spacing:2px;color:rgba(128,222,234,0.4);text-transform:uppercase;font-weight:700;margin-bottom:6px;}
        .oi-sum-val{font-family:'Oxanium',sans-serif;font-size:clamp(16px,2.5vw,22px);font-weight:700;line-height:1;}
        .oi-chart-wrap{background:rgba(6,13,20,0.7);border:1px solid rgba(79,195,247,0.14);border-radius:14px;padding:16px;margin-bottom:20px;}
        .oi-chart-label{font-size:9px;letter-spacing:2px;color:rgba(128,222,234,0.4);text-transform:uppercase;font-weight:700;}
        .oi-table-wrap{background:rgba(6,13,20,0.7);border:1px solid rgba(79,195,247,0.14);border-radius:14px;overflow-x:auto;overflow-y:hidden;-webkit-overflow-scrolling:touch;}
        .oi-table{width:100%;min-width:1080px;border-collapse:collapse;font-family:'JetBrains Mono',monospace;}
        .oi-table-scroll-hint{display:none;align-items:center;gap:6px;font-family:'JetBrains Mono',monospace;font-size:9px;letter-spacing:1.5px;color:rgba(79,195,247,0.4);padding:6px 14px 0;text-transform:uppercase;}
        .oi-table thead th{padding:11px 14px;font-size:9px;letter-spacing:2px;color:rgba(128,222,234,0.45);text-transform:uppercase;font-weight:700;text-align:right;border-bottom:1px solid rgba(79,195,247,0.15);background:rgba(79,195,247,0.05);white-space:nowrap;}
        .oi-table thead th:first-child{text-align:left;}
        .oi-table tbody tr{border-bottom:1px solid rgba(79,195,247,0.06);transition:background 0.15s ease;}
        .oi-table tbody tr:hover{background:rgba(79,195,247,0.05);}
        .oi-table tbody tr.oi-live-row{background:rgba(0,230,118,0.05);border-left:3px solid rgba(0,230,118,0.5);}
        .oi-table tbody td{padding:10px 14px;font-size:clamp(11px,1.4vw,13px);text-align:right;color:#b0bec5;white-space:nowrap;}
        .oi-table tbody td:first-child{text-align:left;color:#e0f7fa;font-weight:700;}
        .oi-time-cell{display:flex;align-items:center;gap:8px;}
        .oi-live-ind{display:inline-flex;align-items:center;gap:4px;font-size:9px;color:#00e676;letter-spacing:1px;font-weight:700;}
        .oi-live-ind::before{content:'';display:inline-block;width:5px;height:5px;border-radius:50%;background:#00e676;box-shadow:0 0 5px #00e676;animation:sb-pulse 1.5s ease-in-out infinite;}
        .oi-call-val{color:#fb7185;}
        .oi-put-val{color:#34d399;}
        .oi-diff-neg{color:#fb7185;font-weight:700;}
        .oi-diff-pos{color:#34d399;font-weight:700;}
        .oi-pcr-val{color:#fbbf24;}
        .oi-signal-ssell{display:inline-block;padding:3px 10px;border-radius:6px;font-size:10px;font-weight:700;letter-spacing:1px;background:rgba(220,38,38,0.2);color:#fca5a5;border:1px solid rgba(220,38,38,0.4);}
        .oi-signal-sell{display:inline-block;padding:3px 10px;border-radius:6px;font-size:10px;font-weight:700;letter-spacing:1px;background:rgba(239,68,68,0.15);color:#f87171;border:1px solid rgba(239,68,68,0.3);}
        .oi-signal-sbuy{display:inline-block;padding:3px 10px;border-radius:6px;font-size:10px;font-weight:700;letter-spacing:1px;background:rgba(5,150,105,0.2);color:#a7f3d0;border:1px solid rgba(5,150,105,0.4);}
        .oi-signal-buy{display:inline-block;padding:3px 10px;border-radius:6px;font-size:10px;font-weight:700;letter-spacing:1px;background:rgba(16,185,129,0.15);color:#6ee7b7;border:1px solid rgba(16,185,129,0.3);}
        .oi-signal-neutral{display:inline-block;padding:3px 10px;border-radius:6px;font-size:10px;font-weight:700;letter-spacing:1px;background:rgba(245,158,11,0.12);color:#fde68a;border:1px solid rgba(245,158,11,0.25);}
        .oi-vwap-cell{color:#93c5fd;font-weight:600;}
        .oi-fut-cell{color:#c4b5fd;}
        .oi-spot-cell{color:#e0f7fa;font-weight:700;}
        .oi-vsig-sell{display:inline-block;padding:2px 8px;border-radius:5px;font-size:9px;font-weight:700;background:rgba(239,68,68,0.12);color:#fca5a5;border:1px solid rgba(239,68,68,0.25);}
        .oi-vsig-buy{display:inline-block;padding:2px 8px;border-radius:5px;font-size:9px;font-weight:700;background:rgba(16,185,129,0.12);color:#6ee7b7;border:1px solid rgba(16,185,129,0.25);}
        .oi-nlevel-badge{display:inline-block;padding:3px 10px;border-radius:6px;font-size:10px;font-weight:700;letter-spacing:0.5px;white-space:nowrap;}
        .oi-nlevel-res{background:rgba(239,68,68,0.12);color:#fca5a5;border:1px solid rgba(239,68,68,0.3);}
        .oi-nlevel-sup{background:rgba(0,188,212,0.12);color:#67e8f9;border:1px solid rgba(0,188,212,0.3);}
        .oi-dist-val{display:inline-block;padding:3px 10px;border-radius:6px;font-size:11px;font-weight:700;font-family:'JetBrains Mono',monospace;}
        .oi-dist-res{background:rgba(239,68,68,0.08);color:#f87171;}
        .oi-dist-sup{background:rgba(0,188,212,0.08);color:#22d3ee;}
        .oi-empty-state{text-align:center;padding:60px 20px;color:rgba(176,190,197,0.3);font-family:'JetBrains Mono',monospace;font-size:13px;}
        /* ── Spot Δ ── */
        .oi-sdelta{display:inline-flex;align-items:center;gap:4px;padding:3px 9px;border-radius:6px;font-size:11px;font-weight:700;font-family:'JetBrains Mono',monospace;white-space:nowrap;}
        .oi-sdelta-up{background:rgba(16,185,129,0.1);color:#34d399;border:1px solid rgba(16,185,129,0.25);}
        .oi-sdelta-dn{background:rgba(239,68,68,0.1);color:#f87171;border:1px solid rgba(239,68,68,0.25);}
        .oi-sdelta-fl{background:rgba(100,116,139,0.1);color:#64748b;border:1px solid rgba(100,116,139,0.2);}
        /* ── VWAP Bias ── */
        .oi-vwap-bias{display:inline-flex;align-items:center;gap:5px;padding:4px 11px;border-radius:20px;font-size:10px;font-weight:700;letter-spacing:0.8px;white-space:nowrap;}
        .oi-vwap-above{background:rgba(16,185,129,0.1);color:#6ee7b7;border:1px solid rgba(16,185,129,0.28);}
        .oi-vwap-below{background:rgba(239,68,68,0.1);color:#fca5a5;border:1px solid rgba(239,68,68,0.28);}
        .oi-vwap-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0;}
        .oi-vwap-above .oi-vwap-dot{background:#10b981;box-shadow:0 0 5px #10b981;}
        .oi-vwap-below .oi-vwap-dot{background:#ef4444;box-shadow:0 0 5px #ef4444;}
        /* ── Signal Streak ── */
        .oi-streak{display:inline-flex;align-items:center;gap:6px;}
        .oi-streak-num{font-family:'Oxanium',sans-serif;font-size:15px;font-weight:800;line-height:1;}
        .oi-streak-sell .oi-streak-num{color:#f87171;}
        .oi-streak-buy  .oi-streak-num{color:#34d399;}
        .oi-streak-neu  .oi-streak-num{color:#fbbf24;}
        .oi-streak-lbl{font-size:8px;letter-spacing:0.8px;color:rgba(176,190,197,0.35);text-transform:uppercase;line-height:1.4;}
        .oi-pips{display:flex;gap:3px;align-items:center;}
        .oi-pip{width:5px;height:5px;border-radius:50%;flex-shrink:0;}
        .oi-pip-sell{background:#f87171;box-shadow:0 0 3px #f87171;}
        .oi-pip-buy{background:#34d399;box-shadow:0 0 3px #34d399;}
        .oi-pip-neu{background:#fbbf24;}
        .oi-pip-old{background:rgba(100,116,139,0.3);}

        .disclaimer{background:rgba(255,183,77,0.1);backdrop-filter:blur(8px);padding:22px;border-radius:12px;border-left:4px solid #ffb74d;font-size:clamp(11px,1.5vw,13px);color:#ffb74d;line-height:1.8;}
        .footer{text-align:center;padding:24px;color:#546e7a;font-size:clamp(10px,1.3vw,12px);background:rgba(10,20,28,0.4);}

        
        /* ══ NIFTY 50 HEATMAP ═══════════════════════════════════════ */
        .hm-breadth-strip{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:20px;background:rgba(6,13,20,0.7);border:1px solid rgba(79,195,247,0.14);border-radius:14px;padding:20px 24px;margin-bottom:20px;}
        .hm-bs-left{display:flex;gap:24px;align-items:center;}
        .hm-bs-stat{text-align:center;}
        .hm-bs-num{font-family:'Orbitron',monospace;font-size:clamp(26px,4vw,36px);font-weight:900;line-height:1;}
        .hm-bs-adv .hm-bs-num{color:#00e676;text-shadow:0 0 20px rgba(0,230,118,0.5);}
        .hm-bs-dec .hm-bs-num{color:#ff5252;text-shadow:0 0 20px rgba(255,82,82,0.5);}
        .hm-bs-neu .hm-bs-num{color:#78909c;}
        .hm-bs-lbl{font-size:9px;letter-spacing:2.5px;color:rgba(176,190,197,0.4);text-transform:uppercase;font-weight:700;margin-top:4px;}
        .hm-bs-donut-wrap{position:relative;width:110px;height:110px;flex-shrink:0;}
        .hm-bs-donut-center{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;}
        .hm-bs-donut-num{font-family:'Orbitron',monospace;font-size:20px;font-weight:900;color:#e0f7fa;}
        .hm-bs-donut-sub{font-size:8px;letter-spacing:2px;color:rgba(128,222,234,0.4);text-transform:uppercase;}
        .hm-bs-right{flex:1;min-width:200px;}
        .hm-breadth-label{font-size:11px;color:rgba(128,222,234,0.5);margin-bottom:8px;letter-spacing:1px;}
        .hm-breadth-row{display:flex;align-items:center;gap:8px;margin-bottom:10px;}
        .hm-br-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;}
        .hm-br-label{font-size:10px;color:rgba(176,190,197,0.5);width:70px;flex-shrink:0;}
        .hm-br-bar-wrap{flex:1;height:4px;background:rgba(0,0,0,0.35);border-radius:2px;overflow:hidden;}
        .hm-br-bar{height:100%;border-radius:2px;transition:width 1s ease;}
        .hm-br-val{font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:700;width:20px;text-align:right;flex-shrink:0;}
        .hm-grid{display:grid;grid-template-columns:repeat(10,minmax(0,1fr));gap:6px;margin-bottom:16px;}
        .hm-cell{border-radius:10px;padding:10px 8px;cursor:default;transition:all 0.2s ease;position:relative;overflow:hidden;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:72px;text-align:center;}
        .hm-cell:hover{transform:scale(1.06);z-index:10;box-shadow:0 8px 24px rgba(0,0,0,0.5);filter:brightness(1.15);}
        .hm-cell-sym{font-family:'Oxanium',sans-serif;font-size:clamp(8px,1.2vw,11px);font-weight:700;letter-spacing:0.3px;line-height:1.2;word-break:break-word;}
        .hm-cell-price{font-family:'JetBrains Mono',monospace;font-size:clamp(7px,0.9vw,9px);opacity:0.75;margin-top:3px;font-weight:600;}
        .hm-cell-chg{font-family:'Oxanium',sans-serif;font-size:clamp(9px,1.2vw,12px);font-weight:800;margin-top:2px;letter-spacing:0.3px;}
        .hm-legend{display:flex;flex-direction:column;align-items:center;margin-bottom:4px;}
        .hm-legend-bar{display:flex;align-items:center;gap:12px;width:100%;max-width:400px;}
        .hm-leg-gradient{flex:1;height:10px;border-radius:5px;background:linear-gradient(90deg,#b91c1c,#ef4444,#374151,#10b981,#065f46);}
        .hm-leg-txt{font-family:'JetBrains Mono',monospace;font-size:10px;font-weight:700;}
        .hm-mover-wrap{background:rgba(6,13,20,0.7);border:1px solid rgba(79,195,247,0.14);border-radius:12px;overflow:hidden;}
        .hm-mover-table{width:100%;border-collapse:collapse;font-family:'JetBrains Mono',monospace;}
        .hm-mover-table thead th{padding:10px 14px;font-size:9px;letter-spacing:2px;color:rgba(128,222,234,0.45);text-transform:uppercase;font-weight:700;text-align:right;border-bottom:1px solid rgba(79,195,247,0.15);background:rgba(79,195,247,0.05);}
        .hm-mover-table thead th:first-child{text-align:left;}
        .hm-mover-table tbody tr{border-bottom:1px solid rgba(79,195,247,0.06);transition:background 0.15s;}
        .hm-mover-table tbody tr:hover{background:rgba(79,195,247,0.05);}
        .hm-mover-table tbody td{padding:9px 14px;font-size:12px;text-align:right;color:#b0bec5;}
        .hm-mover-sym{text-align:left!important;color:#e0f7fa!important;font-weight:700;}
        .hm-mover-prev{color:#546e7a!important;}
        .hm-mover-price{color:#4fc3f7!important;font-weight:600;}
        .hm-mover-chg{font-weight:700;}
        .hm-oi-chart-wrap{background:rgba(6,13,20,0.7);border:1px solid rgba(79,195,247,0.14);border-radius:12px;padding:14px;overflow:hidden;}
        .hm-idx-btn{padding:7px 18px;font-family:'Oxanium',sans-serif;font-size:11px;font-weight:700;letter-spacing:2px;color:rgba(176,190,197,0.5);background:transparent;border:1px solid rgba(79,195,247,0.2);border-radius:8px;cursor:pointer;transition:all 0.2s ease;}
        .hm-idx-btn:hover{color:#4fc3f7;border-color:rgba(79,195,247,0.5);background:rgba(79,195,247,0.08);}
        .hm-idx-btn.active{color:#00e5ff;border-color:rgba(79,195,247,0.6);background:rgba(79,195,247,0.15);box-shadow:0 0 10px rgba(79,195,247,0.1);}
        @media(max-width:900px){.hm-grid{grid-template-columns:repeat(7,minmax(0,1fr));}}
        @media(max-width:600px){
          .hm-grid{grid-template-columns:repeat(5,minmax(0,1fr));gap:4px;}
          .hm-cell{min-height:58px;padding:8px 4px;}
          .hm-breadth-strip{flex-direction:column;align-items:flex-start;}
          div[style*="grid-template-columns:1fr 1fr"]{grid-template-columns:1fr!important;}
          .hm-bs-donut-wrap{align-self:center;}
        }
        @media(max-width:400px){.hm-grid{grid-template-columns:repeat(4,minmax(0,1fr));}}


        @media(max-width:1024px){
            .grid-5{grid-template-columns:repeat(3,minmax(0,1fr));}
            .grid-4{grid-template-columns:repeat(2,minmax(0,1fr));}
            .pf-grid{grid-template-columns:repeat(3,minmax(0,1fr));gap:10px;}
            .nc-cards-grid{grid-template-columns:repeat(3,minmax(0,1fr));}
            .nc-meter-track{width:140px;}
            .input-summary-grid{grid-template-columns:repeat(3,minmax(0,1fr));}
            .oi-summary-strip{grid-template-columns:repeat(2,minmax(0,1fr));}
        }
        @media(max-width:768px){
            .snap-grid{grid-template-columns:repeat(2,minmax(0,1fr));}
            .logic-grid{grid-template-columns:1fr;}
            .strat-grid{grid-template-columns:repeat(2,minmax(0,1fr));}
            .nc-cards-grid{grid-template-columns:repeat(2,minmax(0,1fr));}
            .pf-grid{grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;}
            .input-summary-grid{grid-template-columns:repeat(2,minmax(0,1fr));}
            .signal-grid{grid-template-columns:1fr;}
        }
        @media(max-width:600px){
            .grid-5,.grid-4{grid-template-columns:minmax(0,1fr);}
            .snap-grid{grid-template-columns:repeat(2,minmax(0,1fr));}
            .nc-cards-grid{grid-template-columns:minmax(0,1fr);}
            .nc-section-header{flex-direction:column;align-items:flex-start;}
            .nc-atm-badge{align-self:flex-end;}
            .nc-dir-name{font-size:clamp(18px,5vw,24px);}
            .nc-meters-panel{min-width:unset;width:100%;}
            .nc-meter-track{width:100%;max-width:280px;}
            .pf-avg-strip{grid-template-columns:1fr;gap:0;padding:14px;}
            .pf-avg-sep{display:none;}
            .pf-avg-cell{text-align:left;display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 0;border-bottom:1px solid rgba(79,195,247,0.07);}
            .pf-avg-cell:last-child{border-bottom:none;}
            .pf-avg-eyebrow{margin-bottom:0;}
            .md-direction{font-size:clamp(20px,6vw,28px);}
            .md-row-top,.md-row-bottom{flex-direction:column;align-items:flex-start;}
            div[style*="grid-template-columns:1fr 1fr"]{grid-template-columns:1fr !important;}
            .status-bar{flex-wrap:wrap;}
            .sb-item{flex:1 1 45%;border-right:none;border-bottom:1px solid rgba(79,195,247,0.08);}
            .sb-item:nth-child(odd){border-right:1px solid rgba(79,195,247,0.08);}
            .sb-item:last-child,.sb-item:nth-last-child(-n+2):nth-child(odd){border-bottom:none;}
            .pf-date-range{display:none;}
            .strat-grid{grid-template-columns:1fr;}
            .score-meter{flex-direction:column;}
            .oi-summary-strip{grid-template-columns:1fr 1fr;}
            .oi-table thead th,.oi-table tbody td{padding:6px 6px;font-size:9px;}
            .oi-int-btn{padding:8px 14px;font-size:10px;}
            .oi-table-scroll-hint{display:flex;}
        }
        @media(max-width:400px){
            .snap-grid{grid-template-columns:minmax(0,1fr);}
            .pf-grid{grid-template-columns:minmax(0,1fr);}
            .header h1{letter-spacing:0;}
            .input-summary-grid{grid-template-columns:1fr;}
            .oi-summary-strip{grid-template-columns:1fr;}
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>&#128202; NIFTY 50 DAILY REPORT</h1>
        <div class="status-bar">
            <div class="sb-item">
                <span class="sb-dot sb-dot-gen"></span>
                <span class="sb-label">Generated</span>
                <span class="sb-value gen-val">27-Feb-2026 08:52 IST</span>
            </div>
            <div class="sb-item">
                <span class="sb-dot sb-dot-clock"></span>
                <span class="sb-label">IST Now</span>
                <span class="sb-value clock-val" id="live-ist-clock">--:--:--</span>
            </div>
            
            <div class="sb-item">
                <span class="sb-dot sb-dot-cd"></span>
                <span class="sb-label">Next Refresh</span>
                <span class="sb-value cd-val" id="refresh-countdown">30s</span>
            </div>
        </div>
        <div class="tab-nav" id="tabNav">
            <button class="tab-btn active" data-tab="main" onclick="switchTab('main')">
                <span class="tab-dot"></span> &#128200; Main Analysis <span class="tab-badge">LIVE</span>
            </button>
            <button class="tab-btn" data-tab="heatmap" onclick="switchTab('heatmap')">
                <span class="tab-dot"></span> &#127956; Heatmap <span class="tab-badge">LIVE</span>
            </button>
            <button class="tab-btn" data-tab="oi-trend" onclick="switchTab('oi-trend')">
                <span class="tab-dot"></span> &#128202; Intraday OI Trend <span class="tab-badge">IST</span>
            </button>
            <button class="tab-btn new-badge" data-tab="checklist" onclick="switchTab('checklist')">
                <span class="tab-dot"></span> &#129504; Strategy Checklist <span class="tab-badge">NEW</span>
            </button>
        </div>
    </div>

    <!-- TAB 1: MAIN ANALYSIS -->
    <div class="tab-panel active" id="tab-main">
        <div class="section">
            <div class="section-title"><span>&#128200;</span> MARKET SNAPSHOT</div>
            <div class="snap-grid">
                <div class="g snap-card g-hi"><div class="card-top-row"><span class="card-ico">&#128185;</span><div class="lbl">NIFTY 50 SPOT</div></div><span class="val">&#8377;25,496.55</span></div>
                <div class="g snap-card"><div class="card-top-row"><span class="card-ico">&#127919;</span><div class="lbl">ATM STRIKE</div></div><span class="val">&#8377;25,500</span></div>
                <div class="g snap-card"><div class="card-top-row"><span class="card-ico">&#128197;</span><div class="lbl">EXPIRY DATE</div></div><span class="val" style="font-size:20px">02-Mar-2026</span></div>
            </div>
        </div>

<div class="section">
    <div class="nc-section-header">
        <div class="nc-header-left"><div class="nc-header-icon">📊</div>
        <div><div class="nc-header-title">Change in Open Interest</div>
        <div class="nc-header-sub">Today's Direction Analysis</div></div></div>
        <div class="nc-atm-badge">ATM ±10</div>
    </div>
    <div class="nc-dir-box" style="background:rgba(30,10,14,0.92);border:1px solid rgba(239,68,68,0.35);">
        <div style="display:flex;align-items:stretch;gap:18px;">
            <div class="nc-dir-bar" style="background:linear-gradient(180deg,#ef4444,#b91c1c);"></div>
            <div style="flex:1;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px;">
                <div>
                    <div class="nc-dir-tag">MARKET DIRECTION</div>
                    <div class="nc-dir-name" style="color:#fb7185;">Bearish</div>
                    <div class="nc-dir-signal" style="color:rgba(251,113,133,0.5);">Call Build-up Dominant</div>
                </div>
                <div class="nc-meters-panel"><div class="nc-meter-row"><div class="nc-meter-head-row"><span class="nc-meter-label">🟢 Bull Strength</span><span class="nc-meter-pct" style="color:#34d399;">33%</span></div><div class="nc-meter-track"><div class="nc-meter-fill" style="width:33%;background:linear-gradient(90deg,#10b981,#34d399);"></div><div class="nc-meter-head" style="left:33%;background:#34d399;box-shadow:0 0 8px #34d399;"></div></div></div><div class="nc-meter-row"><div class="nc-meter-head-row"><span class="nc-meter-label">🔴 Bear Strength</span><span class="nc-meter-pct" style="color:#fb7185;">67%</span></div><div class="nc-meter-track"><div class="nc-meter-fill" style="width:67%;background:linear-gradient(90deg,#ef4444,#f97316);"></div><div class="nc-meter-head" style="left:67%;background:#fb7185;box-shadow:0 0 8px #fb7185;"></div></div></div></div>
            </div>
        </div>
    </div>
    <div class="nc-cards-grid"><div class="nc-card"><div class="nc-card-header"><span class="nc-card-label">CALL OI CHANGE</span><span style="font-size:18px;line-height:1;color:#ef4444;">🔴</span></div><div class="nc-card-value" style="color:#fb7185;">+268,464</div><div class="nc-card-sub">CE open interest Δ</div><div class="nc-card-btn" style="color:#ef4444;background:rgba(239,68,68,0.12);border:1px solid rgba(239,68,68,0.4);">Bearish Signal</div></div><div class="nc-card"><div class="nc-card-header"><span class="nc-card-label">PUT OI CHANGE</span><span style="font-size:18px;line-height:1;color:#10b981;">🟢</span></div><div class="nc-card-value" style="color:#34d399;">+133,825</div><div class="nc-card-sub">PE open interest Δ</div><div class="nc-card-btn" style="color:#10b981;background:rgba(16,185,129,0.12);border:1px solid rgba(16,185,129,0.4);">Bullish Signal</div></div><div class="nc-card"><div class="nc-card-header"><span class="nc-card-label">NET OI CHANGE</span><span style="font-size:18px;line-height:1;color:#ef4444;">⚖️</span></div><div class="nc-card-value" style="color:#fb7185;">-134,639</div><div class="nc-card-sub">PE Δ − CE Δ</div><div class="nc-card-btn" style="color:#ef4444;background:rgba(239,68,68,0.12);border:1px solid rgba(239,68,68,0.4);">Bearish Net</div></div></div>
    <div class="logic-box" style="margin-top:16px;">
        <div class="logic-box-head">📖 HOW TO READ</div>
        <div class="logic-grid">
            <div class="logic-item"><span class="lc-info">Call OI +</span> Writers selling calls <span class="lc-bear">Bearish</span>&nbsp;&nbsp;<span class="lc-info">Call OI −</span> Unwinding <span class="lc-bull">Bullish</span></div>
            <div class="logic-item"><span class="lc-info">Put OI +</span> Writers selling puts <span class="lc-bull">Bullish</span>&nbsp;&nbsp;<span class="lc-info">Put OI −</span> Unwinding <span class="lc-bear">Bearish</span></div>
            <div class="logic-item"><span class="lc-info">Net OI</span> = PE Δ − CE Δ &nbsp;·&nbsp; <span class="lc-bull">Positive = Bullish</span> &nbsp;<span class="lc-bear">Negative = Bearish</span></div>
            <div class="logic-item"><span class="lc-info">Bull % + Bear %</span> = 100% &nbsp;·&nbsp; relative dominance</div>
        </div>
    </div>
</div>

    <div class="section">
        <div class="section-title"><span>&#128202;</span> KEY LEVELS</div>

        <!-- Desktop/Tablet: visual bar (hidden on mobile <520px) -->
        <div class="kl-bar-section">
            <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
                <span style="font-size:11px;color:#26c6da;font-weight:700;letter-spacing:1px;">&#9668; SUPPORT ZONE</span>
                <span style="font-size:11px;color:#f44336;font-weight:700;letter-spacing:1px;">RESISTANCE ZONE &#9658;</span>
            </div>
            <div style="position:relative;height:62px;">
                <div class="rl-node-a" style="left:3%;"><div class="rl-lbl" style="color:#26c6da;">Strong<br>Support</div><div class="rl-val" style="color:#26c6da;">&#8377;25,400</div><div class="rl-dot" style="background:#26c6da;margin:6px auto 0;"></div></div>
                <div class="rl-node-a" style="left:22%;"><div class="rl-lbl" style="color:#00bcd4;">Support</div><div class="rl-val" style="color:#00bcd4;">&#8377;25,475</div><div class="rl-dot" style="background:#00bcd4;box-shadow:0 0 8px #00bcd4;margin:6px auto 0;"></div></div>
                <div style="position:absolute;left:38.62%;transform:translateX(-50%);bottom:4px;background:#4fc3f7;color:#000;font-size:11px;font-weight:700;padding:4px 13px;border-radius:6px;white-space:nowrap;z-index:10;box-shadow:0 0 16px rgba(79,195,247,0.7);">&#9660; NOW &nbsp;&#8377;25,497</div>
                <div class="rl-node-a" style="left:75%;"><div class="rl-lbl" style="color:#ff7043;">Resistance</div><div class="rl-val" style="color:#ff7043;">&#8377;25,600</div><div class="rl-dot" style="background:#ff7043;box-shadow:0 0 8px #ff7043;margin:6px auto 0;"></div></div>
                <div class="rl-node-a" style="left:95%;"><div class="rl-lbl" style="color:#f44336;">Strong<br>Resistance</div><div class="rl-val" style="color:#f44336;">&#8377;25,650</div><div class="rl-dot" style="background:#f44336;margin:6px auto 0;"></div></div>
            </div>
            <div style="position:relative;height:8px;border-radius:4px;background:linear-gradient(90deg,#26c6da 0%,#00bcd4 20%,#4fc3f7 40%,#ffb74d 58%,#ff7043 76%,#f44336 100%);box-shadow:0 2px 14px rgba(0,0,0,0.5);">
                <div style="position:absolute;left:38.62%;top:50%;transform:translate(-50%,-50%);width:4px;height:22px;background:#fff;border-radius:2px;box-shadow:0 0 16px rgba(255,255,255,1);z-index:10;"></div>
            </div>
            <div style="position:relative;height:58px;"><div class="rl-node-b" style="left:43%;"><div class="rl-dot" style="background:#ffb74d;box-shadow:0 0 8px #ffb74d;margin:0 auto 5px;"></div><div class="rl-lbl" style="color:#ffb74d;">Max Pain</div><div class="rl-val" style="color:#ffb74d;">₹25,450</div></div></div>
        </div>

        <!-- Mobile: compact table (shown only on <520px) -->
        <table class="kl-mobile-table">
            <tr><td style="color:#26c6da;">&#9660; Strong Support</td><td style="color:#26c6da;">&#8377;25,400</td></tr>
            <tr><td style="color:#00bcd4;">&#9660; Support (S1)</td><td style="color:#00bcd4;">&#8377;25,475</td></tr>
            <tr><td style="color:#4fc3f7;font-weight:700;">&#9654; NOW</td><td style="color:#4fc3f7;font-weight:700;">&#8377;25,497</td></tr>
            <tr><td style="color:#ffb74d;">&#127919; Max Pain</td><td style="color:#ffb74d;">&#8377;25,450</td></tr>
            <tr><td style="color:#ff7043;">&#9650; Resistance (R1)</td><td style="color:#ff7043;">&#8377;25,600</td></tr>
            <tr><td style="color:#f44336;">&#9650; Strong Resistance</td><td style="color:#f44336;">&#8377;25,650</td></tr>
        </table>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px;">
            <div style="background:rgba(244,67,54,0.08);border:1px solid rgba(244,67,54,0.25);border-radius:8px;padding:10px 16px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:4px;">
                <span style="font-size:12px;color:#b0bec5;">&#128205; To Resistance</span>
                <span style="font-size:15px;font-weight:700;color:#f44336;">+103 pts</span>
            </div>
            <div style="background:rgba(0,188,212,0.08);border:1px solid rgba(0,188,212,0.25);border-radius:8px;padding:10px 16px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:4px;">
                <span style="font-size:12px;color:#b0bec5;">&#128205; To Support</span>
                <span style="font-size:15px;font-weight:700;color:#00bcd4;">−21 pts</span>
            </div>
        </div>
    </div>

<div class="section">
    <div class="section-title">
        <span>🏦</span> FII / DII INSTITUTIONAL FLOW
        <span class="pf-live-badge pf-live">● LIVE</span>
        <span class="pf-date-range">Last 5 Trading Days &nbsp;·&nbsp; Feb 20 – Feb 26</span>
    </div>
    <div class="pf-grid"><div class="pf-card" style="border-color:rgba(0,212,255,0.18);"><div class="pf-card-topline" style="background:linear-gradient(90deg,transparent,#00d4ff,transparent);"></div><div class="pf-card-head"><span class="pf-card-date">Feb 20</span><span class="pf-card-day">Fri</span></div><div class="pf-block"><div class="pf-block-header"><span class="pf-block-lbl pf-fii-lbl">FII</span><span class="pf-block-val" style="color:#ff4444;">-935</span></div><div class="pf-bar-track"><div class="pf-bar-fill" style="width:18.3%;background:linear-gradient(90deg,#ff4444,#ff0055);"></div></div></div><div class="pf-divider"></div><div class="pf-block"><div class="pf-block-header"><span class="pf-block-lbl pf-dii-lbl">DII</span><span class="pf-block-val" style="color:#ffb300;">+2,637</span></div><div class="pf-bar-track"><div class="pf-bar-fill" style="width:51.5%;background:linear-gradient(90deg,#ffb300,#ff8f00);"></div></div></div><div class="pf-card-net"><span class="pf-net-lbl">NET</span><span class="pf-net-val" style="color:#34d399;">+1,703</span></div></div><div class="pf-card" style="border-color:rgba(0,212,255,0.18);"><div class="pf-card-topline" style="background:linear-gradient(90deg,transparent,#00d4ff,transparent);"></div><div class="pf-card-head"><span class="pf-card-date">Feb 23</span><span class="pf-card-day">Mon</span></div><div class="pf-block"><div class="pf-block-header"><span class="pf-block-lbl pf-fii-lbl">FII</span><span class="pf-block-val" style="color:#00d4ff;">+3,484</span></div><div class="pf-bar-track"><div class="pf-bar-fill" style="width:68.1%;background:linear-gradient(90deg,#00d4ff,#0090ff);"></div></div></div><div class="pf-divider"></div><div class="pf-block"><div class="pf-block-header"><span class="pf-block-lbl pf-dii-lbl">DII</span><span class="pf-block-val" style="color:#ff4444;">-1,292</span></div><div class="pf-bar-track"><div class="pf-bar-fill" style="width:25.2%;background:linear-gradient(90deg,#ff4444,#ff0055);"></div></div></div><div class="pf-card-net"><span class="pf-net-lbl">NET</span><span class="pf-net-val" style="color:#34d399;">+2,191</span></div></div><div class="pf-card" style="border-color:rgba(0,212,255,0.18);"><div class="pf-card-topline" style="background:linear-gradient(90deg,transparent,#00d4ff,transparent);"></div><div class="pf-card-head"><span class="pf-card-date">Feb 24</span><span class="pf-card-day">Tue</span></div><div class="pf-block"><div class="pf-block-header"><span class="pf-block-lbl pf-fii-lbl">FII</span><span class="pf-block-val" style="color:#ff4444;">-103</span></div><div class="pf-bar-track"><div class="pf-bar-fill" style="width:2.0%;background:linear-gradient(90deg,#ff4444,#ff0055);"></div></div></div><div class="pf-divider"></div><div class="pf-block"><div class="pf-block-header"><span class="pf-block-lbl pf-dii-lbl">DII</span><span class="pf-block-val" style="color:#ffb300;">+3,161</span></div><div class="pf-bar-track"><div class="pf-bar-fill" style="width:61.8%;background:linear-gradient(90deg,#ffb300,#ff8f00);"></div></div></div><div class="pf-card-net"><span class="pf-net-lbl">NET</span><span class="pf-net-val" style="color:#34d399;">+3,059</span></div></div><div class="pf-card" style="border-color:rgba(0,212,255,0.18);"><div class="pf-card-topline" style="background:linear-gradient(90deg,transparent,#00d4ff,transparent);"></div><div class="pf-card-head"><span class="pf-card-date">Feb 25</span><span class="pf-card-day">Wed</span></div><div class="pf-block"><div class="pf-block-header"><span class="pf-block-lbl pf-fii-lbl">FII</span><span class="pf-block-val" style="color:#00d4ff;">+2,992</span></div><div class="pf-bar-track"><div class="pf-bar-fill" style="width:58.4%;background:linear-gradient(90deg,#00d4ff,#0090ff);"></div></div></div><div class="pf-divider"></div><div class="pf-block"><div class="pf-block-header"><span class="pf-block-lbl pf-dii-lbl">DII</span><span class="pf-block-val" style="color:#ffb300;">+5,119</span></div><div class="pf-bar-track"><div class="pf-bar-fill" style="width:100%;background:linear-gradient(90deg,#ffb300,#ff8f00);"></div></div></div><div class="pf-card-net"><span class="pf-net-lbl">NET</span><span class="pf-net-val" style="color:#34d399;">+8,110</span></div></div><div class="pf-card" style="border-color:rgba(0,212,255,0.18);"><div class="pf-card-topline" style="background:linear-gradient(90deg,transparent,#00d4ff,transparent);"></div><div class="pf-card-head"><span class="pf-card-date">Feb 26</span><span class="pf-card-day">Thu</span></div><div class="pf-block"><div class="pf-block-header"><span class="pf-block-lbl pf-fii-lbl">FII</span><span class="pf-block-val" style="color:#ff4444;">-3,466</span></div><div class="pf-bar-track"><div class="pf-bar-fill" style="width:67.7%;background:linear-gradient(90deg,#ff4444,#ff0055);"></div></div></div><div class="pf-divider"></div><div class="pf-block"><div class="pf-block-header"><span class="pf-block-lbl pf-dii-lbl">DII</span><span class="pf-block-val" style="color:#ffb300;">+5,032</span></div><div class="pf-bar-track"><div class="pf-bar-fill" style="width:98.3%;background:linear-gradient(90deg,#ffb300,#ff8f00);"></div></div></div><div class="pf-card-net"><span class="pf-net-lbl">NET</span><span class="pf-net-val" style="color:#34d399;">+1,566</span></div></div></div>
    <div class="pf-avg-strip">
        <div class="pf-avg-cell"><div class="pf-avg-eyebrow">FII 5D Avg</div><div class="pf-avg-val" style="color:#00d4ff;">+394</div><div class="pf-avg-unit">&#8377; Cr / day</div></div>
        <div class="pf-avg-sep"></div>
        <div class="pf-avg-cell"><div class="pf-avg-eyebrow">DII 5D Avg</div><div class="pf-avg-val" style="color:#ffb300;">+2,931</div><div class="pf-avg-unit">&#8377; Cr / day</div></div>
        <div class="pf-avg-sep"></div>
        <div class="pf-avg-cell"><div class="pf-avg-eyebrow">Net Combined</div><div class="pf-avg-val" style="color:#c084fc;">+3,326</div><div class="pf-avg-unit">&#8377; Cr / day</div></div>
    </div>
    <div class="pf-insight-box" style="background:rgba(0,230,118,0.12);border:1px solid rgba(0,230,118,0.3);">
        <div class="pf-insight-header"><span class="pf-insight-lbl" style="color:#00e676;">&#128202; 5-DAY INSIGHT &amp; DIRECTION</span><span class="pf-verdict-badge" style="color:#00e676;background:rgba(0,230,118,0.12);border:1px solid rgba(0,230,118,0.3);">🚀 STRONGLY BULLISH</span></div>
        <div class="pf-insight-text">Both FIIs (avg <span style="color:#00e676;font-weight:700;">₹+394 Cr/day</span>) and DIIs (avg <span style="color:#40c4ff;font-weight:700;">₹+2931 Cr/day</span>) are net buyers — strong dual institutional confirmation. Net combined flow: <span style="color:#b388ff;font-weight:700;">₹+3326 Cr/day</span>.</div>
    </div>
</div>

    <div class="section">
        <div class="section-title"><span>&#129517;</span> MARKET DIRECTION (Algorithmic)</div>
        <div class="md-widget">
            <div class="md-glow"></div>
            <div class="md-row-top">
                <div class="md-label"><div class="md-live-dot"></div>MARKET DIRECTION &nbsp;·&nbsp; ALGORITHMIC</div>
                <div class="md-pills-top"><span class="md-pill md-pill-bull">BULL 1</span><span class="md-pill md-pill-bear">BEAR 5</span></div>
            </div>
            <div class="md-row-bottom">
                <div class="md-direction" style="background:linear-gradient(135deg, #ff6b6b, #cc3333);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;">BEARISH</div>
                <span class="md-pill md-pill-conf-high">HIGH CONFIDENCE</span>
            </div>
        </div>
        <div class="logic-box" style="margin-top:14px;">
            <div class="logic-box-head">&#128202; SCORING LOGIC</div>
            <div class="logic-grid">
                <div class="logic-item"><span class="lc-bull">BULLISH</span><span class="lv">Diff &ge; +3</span> &middot; Above SMAs, oversold RSI, +MACD, PCR &gt; 1.2</div>
                <div class="logic-item"><span class="lc-bear">BEARISH</span><span class="lv">Diff &le; &minus;3</span> &middot; Below SMAs, overbought RSI, &minus;MACD, PCR &lt; 0.7</div>
                <div class="logic-item"><span class="lc-side">SIDEWAYS</span><span class="lv">Diff &minus;2 to +2</span> &middot; Mixed signals, consolidation</div>
                <div class="logic-item"><span class="lc-info">CONFIDENCE</span> HIGH when gap &ge; 4 &nbsp;&middot;&nbsp; OI scope: ATM &plusmn;10 only</div>
            </div>
        </div>
    </div>

        <div class="section">
            <div class="section-title"><span>&#128269;</span> TECHNICAL INDICATORS</div>
            <div class="card-grid grid-5">
            <div class="g ">
                <div class="card-top-row"><span class="card-ico">🟡</span><div class="lbl">RSI (14)</div></div>
                <span class="val">45.2</span>
                <div class="bar-wrap"><div class="bar-fill bar-gold" style="width:45.2%"></div></div>
                <div class="card-foot"><div class="sub">14-period momentum</div><span class="tag tag-neu">Neutral</span></div>
            </div>
            <div class="g g-red">
                <div class="card-top-row"><span class="card-ico">❌</span><div class="lbl">SMA 20</div></div>
                <span class="val">₹25,633</span>
                <div class="bar-wrap"><div class="bar-fill bar-red" style="width:44.7%"></div></div>
                <div class="card-foot"><div class="sub">20-day average</div><span class="tag tag-bear">Below</span></div>
            </div>
            <div class="g g-red">
                <div class="card-top-row"><span class="card-ico">❌</span><div class="lbl">SMA 50</div></div>
                <span class="val">₹25,728</span>
                <div class="bar-wrap"><div class="bar-fill bar-red" style="width:41.0%"></div></div>
                <div class="card-foot"><div class="sub">50-day average</div><span class="tag tag-bear">Below</span></div>
            </div>
            <div class="g g-hi">
                <div class="card-top-row"><span class="card-ico">✅</span><div class="lbl">SMA 200</div></div>
                <span class="val">₹25,345</span>
                <div class="bar-wrap"><div class="bar-fill bar-teal" style="width:56.0%"></div></div>
                <div class="card-foot"><div class="sub">200-day average</div><span class="tag tag-bull">Above</span></div>
            </div>
            <div class="g g-red">
                <div class="card-top-row"><span class="card-ico">🔴</span><div class="lbl">MACD</div></div>
                <span class="val">-38.05</span>
                <div class="bar-wrap"><div class="bar-fill bar-red" style="width:0.0%"></div></div>
                <div class="card-foot"><div class="sub">Signal: -21.37</div><span class="tag tag-bear">Bearish</span></div>
            </div></div>
        </div>

        <div class="section">
            <div class="section-title"><span>&#127919;</span> OPTION CHAIN ANALYSIS <span style="font-size:11px;color:#80deea;font-weight:400;letter-spacing:1px;">(ATM ±10 Strikes Only)</span></div>
            <div class="card-grid grid-4">
            <div class="g g-red">
                <div class="card-top-row"><span class="card-ico">🔴</span><div class="lbl">PCR Ratio (OI)</div></div>
                <span class="val">0.625</span>
                <div class="bar-wrap"><div class="bar-fill bar-red" style="width:31.2%"></div></div>
                <div class="card-foot"><div class="sub">Put/Call OI ratio</div><span class="tag tag-bear">Bearish</span></div>
            </div>
            <div class="g ">
                <div class="card-top-row"><span class="card-ico">🎯</span><div class="lbl">Max Pain</div></div>
                <span class="val">₹25,450</span>
                <div class="bar-wrap"><div class="bar-fill bar-gold" style="width:0.0%"></div></div>
                <div class="card-foot"><div class="sub">Price gravity level</div><span class="tag tag-neu">Expiry Magnet</span></div>
            </div>
            <div class="g g-red">
                <div class="card-top-row"><span class="card-ico">🔴</span><div class="lbl">Max Call OI</div></div>
                <span class="val">₹26,000</span>
                <div class="bar-wrap"><div class="bar-fill bar-red" style="width:61.6%"></div></div>
                <div class="card-foot"><div class="sub">CE wall</div><span class="tag tag-bear">Resistance</span></div>
            </div>
            <div class="g g-hi">
                <div class="card-top-row"><span class="card-ico">🟢</span><div class="lbl">Max Put OI</div></div>
                <span class="val">₹25,000</span>
                <div class="bar-wrap"><div class="bar-fill bar-teal" style="width:38.4%"></div></div>
                <div class="card-foot"><div class="sub">PE floor</div><span class="tag tag-bull">Support</span></div>
            </div></div>
        </div>

        <div class="section">
            <div class="disclaimer"><strong>⚠️ DISCLAIMER</strong><br><br>
            This report is for <strong>EDUCATIONAL purposes only</strong> — NOT financial advice.<br>
            Always use stop losses and consult a SEBI registered investment advisor.<br>
            Past performance does not guarantee future results.</div>
        </div>
    </div><!-- /tab-main -->

    <!-- TAB 4: NIFTY 50 HEATMAP -->
    <div class="tab-panel" id="tab-heatmap">
      <div class="section">
        <div class="section-title">
          <span>🟩</span> NIFTY 50 HEATMAP
          <span style="font-size:10px;color:rgba(128,222,234,0.35);font-weight:400;margin-left:auto;">
            As of: 27-Feb-2026 08:52 IST
          </span>
        </div>

        <!-- Breadth Strip -->
        <div class="hm-breadth-strip">
          <div class="hm-bs-left">
            <div class="hm-bs-stat hm-bs-adv">
              <div class="hm-bs-num" id="hmAdvCount">25</div>
              <div class="hm-bs-lbl">ADVANCE</div>
            </div>
            <div class="hm-bs-stat hm-bs-dec">
              <div class="hm-bs-num" id="hmDecCount">25</div>
              <div class="hm-bs-lbl">DECLINE</div>
            </div>
            <div class="hm-bs-stat hm-bs-neu">
              <div class="hm-bs-num" id="hmNeuCount">1</div>
              <div class="hm-bs-lbl">NEUTRAL</div>
            </div>
          </div>
          <div class="hm-bs-donut-wrap">
            <canvas id="hmDonutCanvas" width="110" height="110"></canvas>
            <div class="hm-bs-donut-center">
              <div class="hm-bs-donut-num">50</div>
              <div class="hm-bs-donut-sub">STOCKS</div>
            </div>
          </div>
          <div class="hm-bs-right">
            <div class="hm-breadth-label" style="font-size:11px;color:rgba(128,222,234,0.5);margin-bottom:8px;letter-spacing:1px;">MARKET BREADTH</div>
            <div class="hm-breadth-row">
              <span class="hm-br-dot" style="background:#00e676;"></span>
              <span class="hm-br-label">Advancing</span>
              <div class="hm-br-bar-wrap"><div class="hm-br-bar" style="width:49.0%;background:linear-gradient(90deg,#00e676,#00bfa5);"></div></div>
              <span class="hm-br-val" style="color:#00e676;">25</span>
            </div>
            <div class="hm-breadth-row">
              <span class="hm-br-dot" style="background:#ff5252;"></span>
              <span class="hm-br-label">Declining</span>
              <div class="hm-br-bar-wrap"><div class="hm-br-bar" style="width:49.0%;background:linear-gradient(90deg,#ff5252,#d50000);"></div></div>
              <span class="hm-br-val" style="color:#ff5252;">25</span>
            </div>
            <div class="hm-breadth-row">
              <span class="hm-br-dot" style="background:#78909c;"></span>
              <span class="hm-br-label">Neutral</span>
              <div class="hm-br-bar-wrap"><div class="hm-br-bar" style="width:2%;background:#546e7a;"></div></div>
              <span class="hm-br-val" style="color:#78909c;">1</span>
            </div>
          </div>
        </div>

        <!-- Heatmap Grid -->
        <div class="hm-grid" id="hmGrid">
          <!-- Populated by JS -->
        </div>

        <!-- Color Legend -->
        <div class="hm-legend">
          <div style="font-size:9px;letter-spacing:2px;color:rgba(128,222,234,0.4);text-transform:uppercase;font-weight:700;margin-bottom:8px;">COLOR SCALE</div>
          <div class="hm-legend-bar">
            <span class="hm-leg-txt" style="color:#d50000;">≤ -2%</span>
            <div class="hm-leg-gradient"></div>
            <span class="hm-leg-txt" style="color:#00e676;">≥ +2%</span>
          </div>
        </div>
      </div>

      <!-- High Weightage Movers + OI Chart (2-col) -->
      <div class="section">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px;align-items:start;">

          <!-- High Weightage Movers Table -->
          <div>
            <div class="section-title" style="border-bottom:1px solid rgba(79,195,247,0.18);padding-bottom:10px;margin-bottom:14px;">
              <span>⚖️</span> HIGH WEIGHTAGE MOVERS
            </div>
            <div class="hm-mover-wrap">
              <table class="hm-mover-table">
                <thead>
                  <tr>
                    <th style="text-align:left;">SYMBOL</th>
                    <th>PREV CLOSE</th>
                    <th>PRICE</th>
                    <th>% CHG</th>
                  </tr>
                </thead>
                <tbody id="hmMoverBody">
                  
                <tr>
                    <td class="hm-mover-sym">RELIANCE</td>
                    <td class="hm-mover-prev">₹1,398.50</td>
                    <td class="hm-mover-price">₹1,406.80</td>
                    <td class="hm-mover-chg" style="color:#00e676;">+0.59%</td>
                </tr>
                <tr>
                    <td class="hm-mover-sym">HDFCBANK</td>
                    <td class="hm-mover-prev">₹907.60</td>
                    <td class="hm-mover-price">₹898.60</td>
                    <td class="hm-mover-chg" style="color:#ff5252;">-0.99%</td>
                </tr>
                <tr>
                    <td class="hm-mover-sym">ICICIBANK</td>
                    <td class="hm-mover-prev">₹1,400.50</td>
                    <td class="hm-mover-price">₹1,404.90</td>
                    <td class="hm-mover-chg" style="color:#00e676;">+0.31%</td>
                </tr>
                <tr>
                    <td class="hm-mover-sym">INFY</td>
                    <td class="hm-mover-prev">₹1,290.10</td>
                    <td class="hm-mover-price">₹1,289.10</td>
                    <td class="hm-mover-chg" style="color:#ff5252;">-0.08%</td>
                </tr>
                <tr>
                    <td class="hm-mover-sym">TCS</td>
                    <td class="hm-mover-prev">₹2,629.30</td>
                    <td class="hm-mover-price">₹2,647.70</td>
                    <td class="hm-mover-chg" style="color:#00e676;">+0.70%</td>
                </tr>
                <tr>
                    <td class="hm-mover-sym">BHARTIARTL</td>
                    <td class="hm-mover-prev">₹1,913.40</td>
                    <td class="hm-mover-price">₹1,929.60</td>
                    <td class="hm-mover-chg" style="color:#00e676;">+0.85%</td>
                </tr>
                <tr>
                    <td class="hm-mover-sym">LT</td>
                    <td class="hm-mover-prev">₹4,298.50</td>
                    <td class="hm-mover-price">₹4,286.50</td>
                    <td class="hm-mover-chg" style="color:#ff5252;">-0.28%</td>
                </tr>
                <tr>
                    <td class="hm-mover-sym">AXISBANK</td>
                    <td class="hm-mover-prev">₹1,403.00</td>
                    <td class="hm-mover-price">₹1,395.50</td>
                    <td class="hm-mover-chg" style="color:#ff5252;">-0.53%</td>
                </tr>
                <tr>
                    <td class="hm-mover-sym">KOTAKBANK</td>
                    <td class="hm-mover-prev">₹424.95</td>
                    <td class="hm-mover-price">₹424.55</td>
                    <td class="hm-mover-chg" style="color:#ff5252;">-0.09%</td>
                </tr>
                <tr>
                    <td class="hm-mover-sym">SBIN</td>
                    <td class="hm-mover-prev">₹1,200.10</td>
                    <td class="hm-mover-price">₹1,209.50</td>
                    <td class="hm-mover-chg" style="color:#00e676;">+0.78%</td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Intraday OI Change Chart (mini) -->
          <div>
            <div class="section-title" style="border-bottom:1px solid rgba(79,195,247,0.18);padding-bottom:10px;margin-bottom:14px;">
              <span>⚡</span> INTRADAY OI CHANGE
              <span id="hmOIPCR" style="margin-left:auto;font-family:'JetBrains Mono',monospace;font-size:11px;color:rgba(128,222,234,0.5);">PCR: —</span>
            </div>
            <div style="display:flex;gap:10px;margin-bottom:8px;">
              <button class="hm-idx-btn active" id="hmBtnNifty" onclick="setHMIndex('nifty',this)">NIFTY</button>
              <button class="hm-idx-btn" id="hmBtnBankNifty" onclick="setHMIndex('banknifty',this)">BANKNIFTY</button>
            </div>
            <div class="hm-oi-chart-wrap">
              <canvas id="hmOICanvas" width="420" height="200"></canvas>
            </div>
            <div style="display:flex;gap:16px;margin-top:8px;">
              <div style="display:flex;align-items:center;gap:6px;font-size:10px;color:rgba(176,190,197,0.5);">
                <span style="display:inline-block;width:24px;height:2px;background:#ef4444;border-radius:1px;"></span> Call OI Change
              </div>
              <div style="display:flex;align-items:center;gap:6px;font-size:10px;color:rgba(176,190,197,0.5);">
                <span style="display:inline-block;width:24px;height:2px;background:#10b981;border-radius:1px;"></span> Put OI Change
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Heatmap data embedded as JSON for JS rendering -->
      <script id="hmDataScript" type="application/json">[{"symbol": "ADANIPORTS", "ticker": "ADANIPORTS.NS", "price": 1550.6, "prev_close": 1528.7, "change_pct": 1.43, "change_abs": 21.9, "volume": 1353287, "high_wt": false}, {"symbol": "APOLLOHOSP", "ticker": "APOLLOHOSP.NS", "price": 7775.0, "prev_close": 7783.0, "change_pct": -0.1, "change_abs": -8.0, "volume": 361759, "high_wt": false}, {"symbol": "ASIANPAINT", "ticker": "ASIANPAINT.NS", "price": 2394.9, "prev_close": 2416.4, "change_pct": -0.89, "change_abs": -21.5, "volume": 588742, "high_wt": false}, {"symbol": "AXISBANK", "ticker": "AXISBANK.NS", "price": 1395.5, "prev_close": 1403.0, "change_pct": -0.53, "change_abs": -7.5, "volume": 8979547, "high_wt": true}, {"symbol": "BAJAJ-AUTO", "ticker": "BAJAJ-AUTO.NS", "price": 10110.0, "prev_close": 10097.0, "change_pct": 0.13, "change_abs": 13.0, "volume": 177814, "high_wt": false}, {"symbol": "BAJAJFINSV", "ticker": "BAJAJFINSV.NS", "price": 2041.3, "prev_close": 2049.3, "change_pct": -0.39, "change_abs": -8.0, "volume": 493126, "high_wt": false}, {"symbol": "BAJFINANCE", "ticker": "BAJFINANCE.NS", "price": 1012.95, "prev_close": 1021.05, "change_pct": -0.79, "change_abs": -8.1, "volume": 4336261, "high_wt": false}, {"symbol": "BEL", "ticker": "BEL.NS", "price": 449.05, "prev_close": 439.3, "change_pct": 2.22, "change_abs": 9.75, "volume": 13738213, "high_wt": false}, {"symbol": "BHARTIARTL", "ticker": "BHARTIARTL.NS", "price": 1929.6, "prev_close": 1913.4, "change_pct": 0.85, "change_abs": 16.2, "volume": 10795028, "high_wt": true}, {"symbol": "CIPLA", "ticker": "CIPLA.NS", "price": 1358.1, "prev_close": 1346.1, "change_pct": 0.89, "change_abs": 12.0, "volume": 2013877, "high_wt": false}, {"symbol": "COALINDIA", "ticker": "COALINDIA.NS", "price": 433.5, "prev_close": 438.6, "change_pct": -1.16, "change_abs": -5.1, "volume": 8650353, "high_wt": false}, {"symbol": "DRREDDY", "ticker": "DRREDDY.NS", "price": 1319.3, "prev_close": 1306.5, "change_pct": 0.98, "change_abs": 12.8, "volume": 1511598, "high_wt": false}, {"symbol": "EICHERMOT", "ticker": "EICHERMOT.NS", "price": 8190.0, "prev_close": 8008.0, "change_pct": 2.27, "change_abs": 182.0, "volume": 427401, "high_wt": false}, {"symbol": "ETERNAL", "ticker": "ETERNAL.NS", "price": 246.5, "prev_close": 250.2, "change_pct": -1.48, "change_abs": -3.7, "volume": 76804030, "high_wt": false}, {"symbol": "GRASIM", "ticker": "GRASIM.NS", "price": 2863.5, "prev_close": 2878.4, "change_pct": -0.52, "change_abs": -14.9, "volume": 662746, "high_wt": false}, {"symbol": "HCLTECH", "ticker": "HCLTECH.NS", "price": 1373.5, "prev_close": 1378.2, "change_pct": -0.34, "change_abs": -4.7, "volume": 2329520, "high_wt": false}, {"symbol": "HDFCBANK", "ticker": "HDFCBANK.NS", "price": 898.6, "prev_close": 907.6, "change_pct": -0.99, "change_abs": -9.0, "volume": 41165937, "high_wt": true}, {"symbol": "HDFCLIFE", "ticker": "HDFCLIFE.NS", "price": 734.0, "prev_close": 735.25, "change_pct": -0.17, "change_abs": -1.25, "volume": 2329954, "high_wt": false}, {"symbol": "HEROMOTOCO", "ticker": "HEROMOTOCO.NS", "price": 5787.0, "prev_close": 5737.5, "change_pct": 0.86, "change_abs": 49.5, "volume": 489797, "high_wt": false}, {"symbol": "HINDALCO", "ticker": "HINDALCO.NS", "price": 941.3, "prev_close": 937.4, "change_pct": 0.42, "change_abs": 3.9, "volume": 3075442, "high_wt": false}, {"symbol": "HINDUNILVR", "ticker": "HINDUNILVR.NS", "price": 2383.3, "prev_close": 2374.9, "change_pct": 0.35, "change_abs": 8.4, "volume": 1470677, "high_wt": false}, {"symbol": "ICICIBANK", "ticker": "ICICIBANK.NS", "price": 1404.9, "prev_close": 1400.5, "change_pct": 0.31, "change_abs": 4.4, "volume": 27288792, "high_wt": true}, {"symbol": "INDIGO", "ticker": "INDIGO.NS", "price": 4933.5, "prev_close": 4947.4, "change_pct": -0.28, "change_abs": -13.9, "volume": 467220, "high_wt": false}, {"symbol": "INFY", "ticker": "INFY.NS", "price": 1289.1, "prev_close": 1290.1, "change_pct": -0.08, "change_abs": -1.0, "volume": 11493914, "high_wt": true}, {"symbol": "ITC", "ticker": "ITC.NS", "price": 318.3, "prev_close": 319.75, "change_pct": -0.45, "change_abs": -1.45, "volume": 11270119, "high_wt": false}, {"symbol": "JIOFIN", "ticker": "JIOFIN.NS", "price": 256.15, "prev_close": 256.95, "change_pct": -0.31, "change_abs": -0.8, "volume": 8691253, "high_wt": false}, {"symbol": "JSWSTEEL", "ticker": "JSWSTEEL.NS", "price": 1280.6, "prev_close": 1275.0, "change_pct": 0.44, "change_abs": 5.6, "volume": 779191, "high_wt": false}, {"symbol": "KOTAKBANK", "ticker": "KOTAKBANK.NS", "price": 424.55, "prev_close": 424.95, "change_pct": -0.09, "change_abs": -0.4, "volume": 13417228, "high_wt": true}, {"symbol": "LT", "ticker": "LT.NS", "price": 4286.5, "prev_close": 4298.5, "change_pct": -0.28, "change_abs": -12.0, "volume": 2370148, "high_wt": true}, {"symbol": "M&M", "ticker": "M&M.NS", "price": 3484.6, "prev_close": 3491.3, "change_pct": -0.19, "change_abs": -6.7, "volume": 1998012, "high_wt": false}, {"symbol": "MARUTI", "ticker": "MARUTI.NS", "price": 15213.0, "prev_close": 15070.0, "change_pct": 0.95, "change_abs": 143.0, "volume": 308213, "high_wt": false}, {"symbol": "MAXHEALTH", "ticker": "MAXHEALTH.NS", "price": 1109.9, "prev_close": 1088.1, "change_pct": 2.0, "change_abs": 21.8, "volume": 3383794, "high_wt": false}, {"symbol": "NESTLEIND", "ticker": "NESTLEIND.NS", "price": 1318.0, "prev_close": 1323.4, "change_pct": -0.41, "change_abs": -5.4, "volume": 438946, "high_wt": false}, {"symbol": "NTPC", "ticker": "NTPC.NS", "price": 381.9, "prev_close": 384.9, "change_pct": -0.78, "change_abs": -3.0, "volume": 10721570, "high_wt": false}, {"symbol": "ONGC", "ticker": "ONGC.NS", "price": 280.1, "prev_close": 277.45, "change_pct": 0.96, "change_abs": 2.65, "volume": 13301761, "high_wt": false}, {"symbol": "POWERGRID", "ticker": "POWERGRID.NS", "price": 303.25, "prev_close": 307.25, "change_pct": -1.3, "change_abs": -4.0, "volume": 14249515, "high_wt": false}, {"symbol": "RELIANCE", "ticker": "RELIANCE.NS", "price": 1406.8, "prev_close": 1398.5, "change_pct": 0.59, "change_abs": 8.3, "volume": 16683858, "high_wt": true}, {"symbol": "SBILIFE", "ticker": "SBILIFE.NS", "price": 2082.8, "prev_close": 2073.6, "change_pct": 0.44, "change_abs": 9.2, "volume": 567098, "high_wt": false}, {"symbol": "SBIN", "ticker": "SBIN.NS", "price": 1209.5, "prev_close": 1200.1, "change_pct": 0.78, "change_abs": 9.4, "volume": 16196052, "high_wt": true}, {"symbol": "SHRIRAMFIN", "ticker": "SHRIRAMFIN.NS", "price": 1104.6, "prev_close": 1085.9, "change_pct": 1.72, "change_abs": 18.7, "volume": 5231414, "high_wt": false}, {"symbol": "SUNPHARMA", "ticker": "SUNPHARMA.NS", "price": 1785.7, "prev_close": 1764.2, "change_pct": 1.22, "change_abs": 21.5, "volume": 2076586, "high_wt": false}, {"symbol": "TATAMOTORS", "ticker": "TMCV.NS", "price": 491.35, "prev_close": 479.85, "change_pct": 2.4, "change_abs": 11.5, "volume": 12183458, "high_wt": false}, {"symbol": "TATAMOTORS", "ticker": "TMPV.NS", "price": 391.55, "prev_close": 381.85, "change_pct": 2.54, "change_abs": 9.7, "volume": 14697480, "high_wt": false}, {"symbol": "TATACONSUM", "ticker": "TATACONSUM.NS", "price": 1159.5, "prev_close": 1172.3, "change_pct": -1.09, "change_abs": -12.8, "volume": 629003, "high_wt": false}, {"symbol": "TATASTEEL", "ticker": "TATASTEEL.NS", "price": 215.52, "prev_close": 214.64, "change_pct": 0.41, "change_abs": 0.88, "volume": 25522669, "high_wt": false}, {"symbol": "TCS", "ticker": "TCS.NS", "price": 2647.7, "prev_close": 2629.3, "change_pct": 0.7, "change_abs": 18.4, "volume": 3464267, "high_wt": true}, {"symbol": "TECHM", "ticker": "TECHM.NS", "price": 1361.8, "prev_close": 1361.8, "change_pct": 0.0, "change_abs": 0.0, "volume": 1587449, "high_wt": false}, {"symbol": "TITAN", "ticker": "TITAN.NS", "price": 4342.6, "prev_close": 4325.0, "change_pct": 0.41, "change_abs": 17.6, "volume": 520985, "high_wt": false}, {"symbol": "TRENT", "ticker": "TRENT.NS", "price": 3856.0, "prev_close": 3922.0, "change_pct": -1.68, "change_abs": -66.0, "volume": 1094939, "high_wt": false}, {"symbol": "ULTRACEMCO", "ticker": "ULTRACEMCO.NS", "price": 12937.0, "prev_close": 13041.0, "change_pct": -0.8, "change_abs": -104.0, "volume": 209041, "high_wt": false}, {"symbol": "WIPRO", "ticker": "WIPRO.NS", "price": 201.08, "prev_close": 201.92, "change_pct": -0.42, "change_abs": -0.84, "volume": 14378069, "high_wt": false}]</script>
    </div><!-- /tab-heatmap -->

    <!-- TAB: INTRADAY OI TREND -->
    <div class="tab-panel" id="tab-oi-trend">
      <div class="section">
        <div class="section-title">
          <span>&#128202;</span> INTRADAY OI TREND
          <span class="annot-badge">AUTO-LOGGED EVERY RUN &middot; IST</span>
          <span style="font-size:10px;color:rgba(128,222,234,0.35);font-weight:400;margin-left:auto;">
            Source: <code style="color:#4fc3f7;font-family:'JetBrains Mono',monospace;">oi_log.json</code>
          </span>
        </div>
        <div class="oi-controls">
          <div class="oi-interval-btns">
            <button class="oi-int-btn active" id="btn3" onclick="setOIInterval(3,this)">3 Min</button>
            <button class="oi-int-btn" id="btn5" onclick="setOIInterval(5,this)">5 Min</button>
            <button class="oi-int-btn" id="btn15" onclick="setOIInterval(15,this)">15 Min</button>
          </div>
          <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
            <div class="oi-live-badge"><span class="oi-live-dot"></span> LIVE &middot; IST &middot; Auto-refresh 30s</div>
            <div id="oiLastFetch" style="font-family:'JetBrains Mono',monospace;font-size:9px;color:rgba(128,222,234,0.3);letter-spacing:1px;">Last fetch: —</div>
          </div>
        </div>
        <div class="oi-summary-strip">
          <div class="oi-sum-card">
            <div class="oi-sum-label">Latest PCR</div>
            <div class="oi-sum-val oi-pcr-val" id="oiLatestPCR">—</div>
          </div>
          <div class="oi-sum-card">
            <div class="oi-sum-label">Net OI Diff</div>
            <div class="oi-sum-val" id="oiLatestDiff">—</div>
          </div>
          <div class="oi-sum-card">
            <div class="oi-sum-label">Spot Price</div>
            <div class="oi-sum-val oi-spot-cell" id="oiLatestSpot">—</div>
          </div>
          <div class="oi-sum-card">
            <div class="oi-sum-label">OI Signal</div>
            <div class="oi-sum-val" id="oiLatestSignal">—</div>
          </div>
        </div>
        <div class="oi-chart-wrap">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
            <div class="oi-chart-label">NET OI DIFF (PE &#916; &#8722; CE &#916;) &mdash; INTRADAY SPARKLINE</div>
            <div id="oiChartEntries" style="font-family:'JetBrains Mono',monospace;font-size:9px;color:rgba(128,222,234,0.3);letter-spacing:1px;"></div>
          </div>
          <canvas id="oiSparklineCanvas" style="width:100%;height:110px;display:block;"></canvas>
        </div>
        <div class="oi-table-wrap">
          <div class="oi-table-scroll-hint">&#8596; Scroll to see all columns</div>
          <table class="oi-table">
            <thead>
              <tr>
                <th style="text-align:left;">TIME (IST)</th>
                <th>CALL OI &#916;</th>
                <th>PUT OI &#916;</th>
                <th>DIFF</th>
                <th>PCR</th>
                <th>OPTION SIGNAL</th>
                <th>SPOT PRICE</th>
                <th>SPOT &#916;</th>
                <th>VWAP BIAS</th>
                <th>STREAK</th>
                <th>NEAREST LEVEL</th>
                <th>DISTANCE</th>
              </tr>
            </thead>
            <tbody id="oiTableBody">
              <tr><td colspan="12" class="oi-empty-state">&#8987; Loading oi_log.json&hellip;</td></tr>
            </tbody>
          </table>
        </div>
          <div class="logic-box" style="margin-top:16px;">
          <div class="logic-box-head">&#128214; HOW TO READ THIS TABLE</div>
          <div class="logic-grid">
            <div class="logic-item"><span class="lc-bear">Call OI +</span> Writers adding calls &#8594; Bearish pressure</div>
            <div class="logic-item"><span class="lc-bull">Put OI +</span> Writers adding puts &#8594; Bullish support</div>
            <div class="logic-item"><span class="lc-info">DIFF</span> = PE &#916; &#8722; CE &#916; &nbsp;&middot;&nbsp; <span class="lc-bull">+ve = Bullish</span> &nbsp;<span class="lc-bear">&#8722;ve = Bearish</span></div>
            <div class="logic-item"><span class="lc-info">3/5/15 Min</span> filters raw rows or aggregates into time slots</div>
            <div class="logic-item"><span class="lc-bull">SPOT &#916;</span> Price change since previous snapshot &nbsp;&middot;&nbsp; &#9650; up &nbsp; &#9660; down &nbsp; &#8594; flat</div>
            <div class="logic-item"><span class="lc-bull">VWAP BIAS</span> ABOVE = Spot &ge; Session VWAP (bullish anchor) &nbsp;&middot;&nbsp; BELOW = Bearish</div>
            <div class="logic-item"><span class="lc-bull">STREAK</span> Consecutive snapshots with same signal &nbsp;&middot;&nbsp; &#215;1 = just flipped &nbsp;&middot;&nbsp; &#215;5+ = strong trend</div>
            <div class="logic-item"><span class="lc-info">Timestamps</span> All times shown in IST (Asia/Kolkata)</div>
          </div>
        </div>
      </div>
    </div><!-- /tab-oi-trend -->

    <div class="tab-panel" id="tab-checklist">
        <div class="section">
            <div class="section-title">
                <span>&#9881;&#65039;</span> LIVE DATA INPUTS
                <span class="annot-badge">AUTO-FILLED FROM LIVE NSE DATA</span>
                <span style="font-size:10px;color:rgba(128,222,234,0.35);font-weight:400;margin-left:auto;">As of: 27-Feb-2026 08:52 IST</span>
            </div>
            <div class="input-summary-grid">
                <div class="inp-summary-card inp-auto-card">
                    <div class="inp-s-label">PCR (OI)</div>
                    <div class="inp-s-val">0.625</div>
                    <div class="inp-s-src">Option Chain</div>
                </div>
                <div class="inp-summary-card inp-auto-card">
                    <div class="inp-s-label">RSI (14)</div>
                    <div class="inp-s-val">45.2</div>
                    <div class="inp-s-src">Technical</div>
                </div>
                <div class="inp-summary-card inp-auto-card">
                    <div class="inp-s-label">MACD</div>
                    <div class="inp-s-val">Bearish</div>
                    <div class="inp-s-src">Technical</div>
                </div>
                <div class="inp-summary-card inp-auto-card">
                    <div class="inp-s-label">Market Trend</div>
                    <div class="inp-s-val">Mixed</div>
                    <div class="inp-s-src">SMA 20/50/200</div>
                </div>
                <div class="inp-summary-card inp-auto-card">
                    <div class="inp-s-label">OI Direction</div>
                    <div class="inp-s-val">Bearish</div>
                    <div class="inp-s-src">CHG OI</div>
                </div>
                <div class="inp-summary-card inp-manual-card">
                    <div class="inp-s-label">Global Bias</div>
                    <div class="inp-s-val">Neutral</div>
                    <div class="inp-s-src">Manual Input</div>
                </div>
                <div class="inp-summary-card inp-manual-card">
                    <div class="inp-s-label">Vol at Support</div>
                    <div class="inp-s-val"><span class="na-inline">N/A</span></div>
                    <div class="inp-s-src">Manual Input</div>
                </div>
                <div class="inp-summary-card inp-manual-card">
                    <div class="inp-s-label">Vol at Resistance</div>
                    <div class="inp-s-val"><span class="na-inline">N/A</span></div>
                    <div class="inp-s-src">Manual Input</div>
                </div>
                <div class="inp-summary-card inp-manual-card">
                    <div class="inp-s-label">IV View</div>
                    <div class="inp-s-val">NORMAL</div>
                    <div class="inp-s-src">Manual Input</div>
                </div>
            </div>
        </div>
        <div class="section">
            <div class="section-title">
                <span>&#128203;</span> SIGNAL CHECKLIST
                <span style="font-size:10px;color:rgba(128,222,234,0.35);font-weight:400;margin-left:auto;">
                    0 Bullish &middot; 4 Bearish &middot; 2 Neutral &middot; 2 N/A
                </span>
            </div>
            <div class="signal-grid">
        <div class="sig-card">
            <div class="sig-icon sig-bear">📊</div>
            <div class="sig-body">
                <div class="sig-name">PCR (OI Ratio) <span class="auto-badge">AUTO</span></div>
                <div class="sig-val">0.625</div>
                <div class="sig-msg">PCR 0.625 → below 0.8 — excess call writing, bearish sentiment</div>
            </div>
            <div class="sig-score score-n">-1</div>
        </div>
        <div class="sig-card">
            <div class="sig-icon sig-neu">📈</div>
            <div class="sig-body">
                <div class="sig-name">RSI (14-Day) <span class="auto-badge">AUTO</span></div>
                <div class="sig-val">45.2</div>
                <div class="sig-msg">RSI 45.2 → 40–60 zone — neutral, no overbought/oversold signal</div>
            </div>
            <div class="sig-score score-0">0</div>
        </div>
        <div class="sig-card">
            <div class="sig-icon sig-bear">⚡</div>
            <div class="sig-body">
                <div class="sig-name">MACD Signal <span class="auto-badge">AUTO</span></div>
                <div class="sig-val">Bearish Crossover</div>
                <div class="sig-msg">MACD crossed below signal line — bearish momentum</div>
            </div>
            <div class="sig-score score-n">-1</div>
        </div>
        <div class="sig-card">
            <div class="sig-icon sig-bear">📉</div>
            <div class="sig-body">
                <div class="sig-name">Market Trend (SMAs) <span class="auto-badge">AUTO</span></div>
                <div class="sig-val">Weak / Mixed</div>
                <div class="sig-msg">Price below majority of SMAs — trend weakening</div>
            </div>
            <div class="sig-score score-n">-1</div>
        </div>
        <div class="sig-card">
            <div class="sig-icon sig-bear">🔄</div>
            <div class="sig-body">
                <div class="sig-name">OI Direction <span class="auto-badge">AUTO</span></div>
                <div class="sig-val">Bearish OI</div>
                <div class="sig-msg">Net OI change is bearish — call build-up / put unwinding dominant</div>
            </div>
            <div class="sig-score score-n">-1</div>
        </div>
        <div class="sig-card">
            <div class="sig-icon sig-neu">🌐</div>
            <div class="sig-body">
                <div class="sig-name">Global Market Bias <span class="manual-badge">MANUAL</span></div>
                <div class="sig-val">Neutral</div>
                <div class="sig-msg">Global indices mixed — no directional edge</div>
            </div>
            <div class="sig-score score-0">0</div>
        </div>
        <div class="sig-card">
            <div class="sig-icon sig-na">📦</div>
            <div class="sig-body">
                <div class="sig-name">Volume at Support <span class="manual-badge">MANUAL</span></div>
                <div class="sig-val na-val">N/A</div>
                <div class="sig-msg">Volume at support not provided — skipped</div>
            </div>
            <div class="sig-score score-na">N/A</div>
        </div>
        <div class="sig-card">
            <div class="sig-icon sig-na">📦</div>
            <div class="sig-body">
                <div class="sig-name">Volume at Resistance <span class="manual-badge">MANUAL</span></div>
                <div class="sig-val na-val">N/A</div>
                <div class="sig-msg">Volume at resistance not provided — skipped</div>
            </div>
            <div class="sig-score score-na">N/A</div>
        </div></div>
            <div class="score-meter">
                <div class="score-ring-wrap">
                    <svg width="120" height="120" viewBox="0 0 110 110">
                        <circle cx="55" cy="55" r="46" fill="none" stroke="rgba(79,195,247,0.08)" stroke-width="9"/>
                        <circle cx="55" cy="55" r="46" fill="none"
                            stroke="#ff5252" stroke-width="9"
                            stroke-linecap="round"
                            stroke-dasharray="289.0"
                            stroke-dashoffset="144.5"
                            style="transform:rotate(-90deg);transform-origin:55px 55px;"/>
                    </svg>
                    <div class="score-ring-label">
                        <div class="score-ring-num" style="color:#ff5252;">-4</div>
                        <div class="score-ring-txt">SCORE</div>
                    </div>
                </div>
                <div class="score-detail">
                    <div class="score-bias-lbl" style="background:linear-gradient(135deg,#ff5252,#b71c1c);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;">STRONGLY BEARISH</div>
                    <div class="score-sub">
                        Score -4 from 8 signals (2 skipped as N/A).<br>
                        Strong directional conviction — proceed with caution and stop losses.
                    </div>
                    <div class="score-pills">
                        <span class="sc-pill sc-pill-bull">&#10003; BULL: 0</span>
                        <span class="sc-pill sc-pill-bear">&#10007; BEAR: 4</span>
                        <span class="sc-pill sc-pill-neu">&#9633; NEUTRAL: 2</span>
                        <span class="sc-pill sc-pill-na">— N/A: 2</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="section">
            <div class="section-title">
                <span>&#127919;</span> SUGGESTED STRATEGY TYPES
                <span style="font-size:10px;color:rgba(176,190,197,0.4);font-weight:400;letter-spacing:1px;">
                    For study &amp; backtesting only &mdash; NOT financial advice
                </span>
            </div>
            <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;margin-bottom:16px;">
                <div style="font-size:12px;color:rgba(176,190,197,0.4);">
                    IV View: <strong style="color:#ff5252;">NORMAL</strong>
                    &nbsp;&middot;&nbsp; Bias: <strong style="color:#ff5252;">STRONGLY BEARISH</strong>
                    &nbsp;&middot;&nbsp; <span style="color:rgba(128,222,234,0.4);">11 strategies found</span>
                </div>
                <div style="display:flex;gap:8px;flex-wrap:wrap;">
                    <button class="filter-btn active" onclick="filterStrats('all',this)">All</button>
                    <button class="filter-btn" onclick="filterStrats('bullish',this)">&#128994; Bullish</button>
                    <button class="filter-btn" onclick="filterStrats('bearish',this)">&#128308; Bearish</button>
                    <button class="filter-btn" onclick="filterStrats('neutral',this)">&#128993; Neutral</button>
                    <button class="filter-btn" onclick="filterStrats('volatility',this)">&#128995; Volatility</button>
                    <button class="filter-btn" onclick="filterStrats('advanced',this)">&#128309; Advanced</button>
                </div>
            </div>
            <div class="strat-grid" id="stratGrid">
        <div class="strat-card strat-bear" data-type="bearish">
            <div class="strat-num">01 · PRIMARY</div>
            <div class="strat-name">Long Put</div>
            <span class="strat-tag strat-tag-bear">🔴 Bearish</span>
        </div>
        <div class="strat-card strat-bear" data-type="bearish">
            <div class="strat-num">02 · PRIMARY</div>
            <div class="strat-name">Bear Put Spread</div>
            <span class="strat-tag strat-tag-bear">🔴 Bearish</span>
        </div>
        <div class="strat-card strat-bear" data-type="bearish">
            <div class="strat-num">03 · PRIMARY</div>
            <div class="strat-name">Bear Call Spread</div>
            <span class="strat-tag strat-tag-bear">🔴 Bearish</span>
        </div>
        <div class="strat-card strat-bear" data-type="bearish">
            <div class="strat-num">04 · PRIMARY</div>
            <div class="strat-name">Bear Put Ladder</div>
            <span class="strat-tag strat-tag-bear">🔴 Bearish</span>
        </div>
        <div class="strat-card strat-bear" data-type="bearish">
            <div class="strat-num">05 · SECONDARY</div>
            <div class="strat-name">Bear Call Ladder</div>
            <span class="strat-tag strat-tag-bear">🔴 Bearish</span>
        </div>
        <div class="strat-card strat-bear" data-type="bearish">
            <div class="strat-num">06 · SECONDARY</div>
            <div class="strat-name">Synthetic Short</div>
            <span class="strat-tag strat-tag-bear">🔴 Bearish</span>
        </div>
        <div class="strat-card strat-bear" data-type="bearish">
            <div class="strat-num">07 · SECONDARY</div>
            <div class="strat-name">Put Ratio Backspread</div>
            <span class="strat-tag strat-tag-bear">🔴 Bearish</span>
        </div>
        <div class="strat-card strat-vol" data-type="volatility">
            <div class="strat-num">08 · SECONDARY</div>
            <div class="strat-name">Strip (Bearish Bias)</div>
            <span class="strat-tag strat-tag-vol">🟣 Volatility</span>
        </div>
        <div class="strat-card strat-misc" data-type="advanced">
            <div class="strat-num">09 · ADVANCED</div>
            <div class="strat-name">Call Ratio Spread</div>
            <span class="strat-tag strat-tag-misc">🔵 Advanced</span>
        </div>
        <div class="strat-card strat-misc" data-type="advanced">
            <div class="strat-num">10 · ADVANCED</div>
            <div class="strat-name">Put Ratio Spread</div>
            <span class="strat-tag strat-tag-misc">🔵 Advanced</span>
        </div>
        <div class="strat-card strat-misc" data-type="advanced">
            <div class="strat-num">11 · ADVANCED</div>
            <div class="strat-name">Christmas Tree Spread</div>
            <span class="strat-tag strat-tag-misc">🔵 Advanced</span>
        </div></div>
        </div>
        <div class="section">
            <div class="section-title"><span>&#128218;</span> SCORING LEGEND</div>
            <div class="logic-box" style="margin-top:0;">
                <div class="logic-box-head">HOW THE SCORE WORKS</div>
                <div class="logic-grid">
                    <div class="logic-item"><span class="lc-bull">+1</span> Signal is bullish &mdash; adds to bull case</div>
                    <div class="logic-item"><span class="lc-bear">&minus;1</span> Signal is bearish &mdash; adds to bear case</div>
                    <div class="logic-item"><span class="lc-side">0</span> Neutral signal &mdash; no directional contribution</div>
                    <div class="logic-item"><span class="lc-info">N/A</span> Data not available &mdash; excluded from score</div>
                    <div class="logic-item"><span class="lc-bull">&ge; +3</span> Strongly Bullish &middot; <span class="lc-bull">+1/+2</span> Mildly Bullish</div>
                    <div class="logic-item"><span class="lc-bear">&le; &minus;3</span> Strongly Bearish &middot; <span class="lc-bear">&minus;1/&minus;2</span> Mildly Bearish</div>
                    <div class="logic-item"><span class="lc-info">AUTO</span> Filled from live NSE + yfinance data</div>
                    <div class="logic-item"><span class="lc-side">MANUAL</span> Requires your input &mdash; shown as N/A if not set</div>
                </div>
            </div>
        </div>
        <div class="section">
            <div class="disclaimer">
                <strong>&#9888;&#65039; DISCLAIMER</strong><br><br>
                This checklist is for <strong>EDUCATIONAL purposes only</strong> &mdash; NOT financial advice.<br>
                Strategy suggestions are based on a rules-based scoring model and have not been backtested.<br>
                Always validate with your own analysis. Consult a SEBI-registered investment advisor.
            </div>
        </div>
    </div>

    <div class="footer">
        <p>Automated Nifty 50 · Option Chain + Technical + Heatmap + Intraday OI Trend + Strategy Checklist</p>
        <p style="margin-top:6px;">&#169; 2026 · Deep Ocean Theme · Navy Command OI · Pulse Flow FII/DII · IST Timestamps · For Educational Purposes Only</p>
    </div>
</div>

<script>
(function() {
    var INTERVAL  = 30000;
    var countdown = INTERVAL / 1000;

    function istNow() { return new Date(new Date().toLocaleString('en-US',{timeZone:'Asia/Kolkata'})); }
    function pad(n){ return String(n).padStart(2,'0'); }
    function fmtTime(d){ return pad(d.getHours())+':'+pad(d.getMinutes())+':'+pad(d.getSeconds()); }
    function fmtDate(d){
        var M=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
        return pad(d.getDate())+'-'+M[d.getMonth()]+'-'+d.getFullYear();
    }
    function tick() {
        var now = istNow();
        var clockEl = document.getElementById('live-ist-clock');
        if (clockEl) clockEl.textContent = fmtDate(now) + '  ' + fmtTime(now) + ' IST';
        countdown--;
        if (countdown < 0) countdown = INTERVAL / 1000;
        var cdEl = document.getElementById('refresh-countdown');
        if (cdEl) { var s=countdown%60; var m=Math.floor(countdown/60); cdEl.textContent=(m>0?m+'m ':'')+s+'s'; }
    }
    setInterval(tick, 1000);
    tick();

    function silentRefresh() {
        // Only refresh live data feeds — NO DOM rebuild, NO flicker
        loadOILog();
        if (typeof window.renderHeatmap === 'function') window.renderHeatmap();
        countdown = INTERVAL / 1000;
    }
    setInterval(silentRefresh, INTERVAL);
})();

function switchTab(tab) {
    document.querySelectorAll('.tab-panel').forEach(function(p){ p.classList.remove('active'); });
    document.querySelectorAll('.tab-btn').forEach(function(b){ b.classList.remove('active'); });
    var panel=document.getElementById('tab-'+tab);
    var btn=document.querySelector('[data-tab="'+tab+'"]');
    if(panel) panel.classList.add('active');
    if(btn)   btn.classList.add('active');
    if(tab==='oi-trend') loadOILog();
    if(tab==='heatmap') { window.renderHeatmap && window.renderHeatmap(); }
}

function filterStrats(type, btn) {
    document.querySelectorAll('.filter-btn').forEach(function(b){ b.classList.remove('active'); });
    btn.classList.add('active');
    document.querySelectorAll('.strat-card').forEach(function(c){
        c.style.display=(type==='all'||c.dataset.type===type)?'':'none';
    });
}

var _oiInterval = 3;
var _oiData     = [];

function setOIInterval(mins, btn) {
    _oiInterval = mins;
    document.querySelectorAll('.oi-int-btn').forEach(function(b){ b.classList.remove('active'); });
    btn.classList.add('active');
    renderOITable(_oiData);
}

function fmtIN(n) {
    var abs = Math.abs(n);
    var sign = n < 0 ? '-' : '+';
    if (abs >= 10000000) return sign + (abs/10000000).toFixed(2) + ' Cr';
    if (abs >= 100000)   return sign + (abs/100000).toFixed(2)   + ' L';
    if (abs === 0)       return '0';
    return (n < 0 ? '-' : '+') + abs.toLocaleString('en-IN');
}

function signalHtml(sig) {
    var s = (sig||'').toUpperCase().trim();
    if (s === 'STRONG SELL') return '<span class="oi-signal-ssell">STRONG SELL</span>';
    if (s === 'SELL')        return '<span class="oi-signal-sell">SELL</span>';
    if (s === 'STRONG BUY')  return '<span class="oi-signal-sbuy">STRONG BUY</span>';
    if (s === 'BUY')         return '<span class="oi-signal-buy">BUY</span>';
    return '<span class="oi-signal-neutral">NEUTRAL</span>';
}

function vsigHtml(sig) {
    return (sig||'').toUpperCase() === 'BUY'
        ? '<span class="oi-vsig-buy">BUY</span>'
        : '<span class="oi-vsig-sell">SELL</span>';
}

function filterByInterval(data, mins) {
    if (mins === 3) return data;
    var grouped = {};
    data.forEach(function(row) {
        var parts    = (row.time||'00:00').split(':');
        var h        = parseInt(parts[0]||0);
        var m        = parseInt(parts[1]||0);
        var slotMin  = Math.floor(m / mins) * mins;
        var key      = String(h).padStart(2,'0') + ':' + String(slotMin).padStart(2,'0');
        if (!grouped[key]) grouped[key] = [];
        grouped[key].push(row);
    });
    var keys = Object.keys(grouped).sort().reverse();
    return keys.map(function(key) {
        var rows    = grouped[key];
        var last    = rows[rows.length - 1];
        var totalCE = rows.reduce(function(a,r){ return a+(r.call_oi_chg||0); }, 0);
        var totalPE = rows.reduce(function(a,r){ return a+(r.put_oi_chg||0); }, 0);
        return {
            time:          key + ' IST',
            call_oi_chg:   totalCE,
            put_oi_chg:    totalPE,
            diff:          totalPE - totalCE,
            pcr:           last.pcr,
            opt_signal:    last.opt_signal,
            vwap:          last.vwap,
            spot_price:    last.spot_price,
            vwap_bias:     last.vwap_bias,
            nearest_level: last.nearest_level,
            nearest_label: last.nearest_label,
            distance_pts:  last.distance_pts,
            vwap_signal:   last.vwap_signal,
            _isLive:       rows[0]._isLive,
        };
    });
}

function renderOITable(data) {
    var tbody = document.getElementById('oiTableBody');
    if (!tbody) return;
    if (!data || data.length === 0) {
        tbody.innerHTML = '<tr><td colspan="12" class="oi-empty-state">&#128218; No data yet.</td></tr>';
        return;
    }
    var filtered = filterByInterval(data, _oiInterval);
    var latest = filtered[0];

    // ── Update summary cards (text only, no DOM rebuild) ──
    if (latest) {
        var el;
        el = document.getElementById('oiLatestPCR'); if (el) el.textContent = latest.pcr || '—';
        el = document.getElementById('oiLatestDiff');
        if (el) { el.textContent = fmtIN(latest.diff || 0); el.className = 'oi-sum-val ' + ((latest.diff||0) >= 0 ? 'oi-diff-pos' : 'oi-diff-neg'); }
        el = document.getElementById('oiLatestSpot'); if (el) el.textContent = '₹' + ((latest.spot_price||0).toLocaleString('en-IN'));
        el = document.getElementById('oiLatestSignal'); if (el) el.innerHTML = signalHtml(latest.opt_signal);
    }
    var ce = document.getElementById('oiChartEntries');
    if (ce) ce.textContent = filtered.length + ' candles';

    // ── Redraw sparkline (canvas, no flicker) ──
    drawSparkline(filtered);

    // ── Smart table update: add new rows only, no full rebuild ──
    var existingRows = tbody.querySelectorAll('tr[data-time]');
    var existingTimes = {};
    existingRows.forEach(function(r){ existingTimes[r.getAttribute('data-time')] = r; });

    // Remove LIVE badge from previous live row
    var prevLive = tbody.querySelector('.oi-live-row');
    if (prevLive) {
        prevLive.classList.remove('oi-live-row');
        var liveInd = prevLive.querySelector('.oi-live-ind');
        if (liveInd) liveInd.remove();
        var td = prevLive.querySelector('td:first-child');
        if (td) { var div = td.querySelector('.oi-time-cell'); if (div) td.textContent = div.textContent.replace('LIVE','').trim(); }
    }

    // Build new rows for times not yet in table, prepend them
    var newRowsHtml = '';
    filtered.forEach(function(row, idx) {
        var t = row.time || '';
        if (!existingTimes[t]) {
            var isLive  = (idx === 0);
            var diffCls = (row.diff||0) >= 0 ? 'oi-diff-pos' : 'oi-diff-neg';
            var timeCell = isLive
                ? '<div class="oi-time-cell">' + t + '&nbsp;<span class="oi-live-ind">LIVE</span></div>'
                : t;
            var isBuy = (row.opt_signal||'').toUpperCase().indexOf('BUY') >= 0;
            var isSell = (row.opt_signal||'').toUpperCase().indexOf('SELL') >= 0;
            var nlabel = row.nearest_label || (isBuy ? 'R1' : isSell ? 'S1' : '—');
            var nval   = row.nearest_level ? '₹' + row.nearest_level.toLocaleString('en-IN') : '—';
            var nlevelHtml = row.nearest_level
                ? '<span class="oi-nlevel-badge ' + (isBuy ? 'oi-nlevel-res' : 'oi-nlevel-sup') + '">'
                  + nlabel + ' &nbsp;' + nval + '</span>'
                : '<span style="color:rgba(176,190,197,0.3);">—</span>';
            var distHtml = row.distance_pts != null
                ? '<span class="oi-dist-val ' + (isBuy ? 'oi-dist-res' : 'oi-dist-sup') + '">'
                  + (isBuy ? '+' : '-') + Math.abs(row.distance_pts) + ' pts'
                  + (row.nearest_label === 'S2' || row.nearest_label === 'R2'
                      ? ' <span style="font-size:8px;opacity:0.6;">(to ' + (row.nearest_label||'') + ')</span>'
                      : '')
                  + '</span>'
                : '<span style="color:rgba(176,190,197,0.3);">—</span>';

            // ── Spot Δ ──
            var prevRow = filtered[idx + 1];
            var spotDelta = (prevRow && prevRow.spot_price && row.spot_price)
                ? Math.round((row.spot_price - prevRow.spot_price) * 10) / 10
                : null;
            var spotDeltaHtml;
            if (spotDelta === null) {
                spotDeltaHtml = '<span style="color:rgba(176,190,197,0.2);">—</span>';
            } else if (Math.abs(spotDelta) < 0.5) {
                spotDeltaHtml = '<span class="oi-sdelta oi-sdelta-fl">→ 0.0</span>';
            } else if (spotDelta > 0) {
                spotDeltaHtml = '<span class="oi-sdelta oi-sdelta-up">▲ +' + spotDelta.toFixed(1) + '</span>';
            } else {
                spotDeltaHtml = '<span class="oi-sdelta oi-sdelta-dn">▼ ' + spotDelta.toFixed(1) + '</span>';
            }

            // ── VWAP Bias ──
            var vsig = (row.vwap_bias || (row.vwap_signal === 'BUY' ? 'ABOVE' : row.vwap_signal === 'SELL' ? 'BELOW' : '')).toUpperCase();
            var vwapBiasHtml = vsig === 'ABOVE'
                ? '<span class="oi-vwap-bias oi-vwap-above"><span class="oi-vwap-dot"></span>ABOVE</span>'
                : vsig === 'BELOW'
                    ? '<span class="oi-vwap-bias oi-vwap-below"><span class="oi-vwap-dot"></span>BELOW</span>'
                    : '<span style="color:rgba(176,190,197,0.2);">—</span>';

            // ── Signal Streak ──
            var streakCount = 1;
            var curSig = (row.opt_signal || '').toUpperCase();
            for (var si = idx + 1; si < filtered.length; si++) {
                if ((filtered[si].opt_signal || '').toUpperCase() === curSig) streakCount++;
                else break;
            }
            var streakCls = isBuy ? 'oi-streak-buy' : isSell ? 'oi-streak-sell' : 'oi-streak-neu';
            var streakLbl = streakCount === 1 ? 'NEW<br>signal' : 'streak';
            var pips = '';
            for (var pi = 0; pi < 6; pi++) {
                var pipIdx = idx + pi;
                var pipSig = pipIdx < filtered.length ? (filtered[pipIdx].opt_signal || '').toUpperCase() : '';
                var pipCls = pipSig.indexOf('BUY') >= 0 ? 'oi-pip-buy' : pipSig.indexOf('SELL') >= 0 ? 'oi-pip-sell' : pipSig ? 'oi-pip-neu' : 'oi-pip-old';
                pips += '<div class="oi-pip ' + pipCls + '"></div>';
            }
            var streakHtml = '<div class="oi-streak ' + streakCls + '">'
                + '<div><div class="oi-streak-num">×' + streakCount + '</div><div class="oi-streak-lbl">' + streakLbl + '</div></div>'
                + '<div class="oi-pips">' + pips + '</div>'
                + '</div>';

            newRowsHtml += '<tr class="' + (isLive ? 'oi-live-row' : '') + '" data-time="' + t + '">'
                + '<td>' + timeCell + '</td>'
                + '<td class="oi-call-val">' + fmtIN(row.call_oi_chg||0) + '</td>'
                + '<td class="oi-put-val">'  + fmtIN(row.put_oi_chg||0)  + '</td>'
                + '<td class="' + diffCls + '">' + fmtIN(row.diff||0) + '</td>'
                + '<td class="oi-pcr-val">'  + (row.pcr||'—') + '</td>'
                + '<td>' + signalHtml(row.opt_signal) + '</td>'
                + '<td class="oi-spot-cell">'+ (row.spot_price ? row.spot_price.toFixed(2) : '—') + '</td>'
                + '<td>' + spotDeltaHtml + '</td>'
                + '<td>' + vwapBiasHtml + '</td>'
                + '<td>' + streakHtml + '</td>'
                + '<td>' + nlevelHtml + '</td>'
                + '<td>' + distHtml + '</td>'
                + '</tr>';
        } else if (idx === 0) {
            // Mark existing top row as LIVE
            var r = existingTimes[t];
            r.classList.add('oi-live-row');
            var td = r.querySelector('td:first-child');
            if (td && !td.querySelector('.oi-live-ind')) {
                td.innerHTML = '<div class="oi-time-cell">' + t + '&nbsp;<span class="oi-live-ind">LIVE</span></div>';
            }
        }
    });

    if (newRowsHtml) {
        // Save scroll position, insert rows at top, restore scroll
        var scrollEl = tbody.closest('.oi-table-wrap') || window;
        var sy = scrollEl === window ? window.scrollY : scrollEl.scrollTop;
        tbody.insertAdjacentHTML('afterbegin', newRowsHtml);
        if (scrollEl === window) window.scrollTo({top: sy, behavior: 'instant'});
        else scrollEl.scrollTop = sy;
    }

    // Remove empty state row if present
    var emptyRow = tbody.querySelector('.oi-empty-state');
    if (emptyRow) emptyRow.closest('tr').remove();
}

function drawSparkline(data) {
    var canvas = document.getElementById('oiSparklineCanvas');
    if (!canvas || !canvas.getContext) return;
    var ctx = canvas.getContext('2d');
    var W   = canvas.parentElement ? (canvas.parentElement.clientWidth - 32) : 600;
    var H   = 110;
    canvas.width  = W; canvas.height = H;
    var reversed = data.slice().reverse();
    var diffs    = reversed.map(function(r){ return r.diff || 0; });
    if (diffs.length < 2) { ctx.clearRect(0,0,W,H); return; }
    var minV  = Math.min.apply(null, diffs);
    var maxV  = Math.max.apply(null, diffs);
    var range = (maxV - minV) || 1;
    var pad   = 10;
    function toX(i) { return (i / (diffs.length-1)) * (W - 2*pad) + pad; }
    function toY(v) { return H - ((v - minV) / range) * (H - 2*pad) - pad; }
    ctx.clearRect(0, 0, W, H);
    var zeroY = toY(0);
    ctx.save(); ctx.strokeStyle = 'rgba(79,195,247,0.18)'; ctx.lineWidth = 1; ctx.setLineDash([4, 4]);
    ctx.beginPath(); ctx.moveTo(pad, zeroY); ctx.lineTo(W-pad, zeroY); ctx.stroke(); ctx.restore();
    var lastDiff  = diffs[diffs.length-1];
    var lineColor = lastDiff >= 0 ? '#10b981' : '#ef4444';
    var gradTop   = lastDiff >= 0 ? 'rgba(16,185,129,0.35)' : 'rgba(239,68,68,0.35)';
    var grad = ctx.createLinearGradient(0, 0, 0, H);
    grad.addColorStop(0, gradTop); grad.addColorStop(1, 'rgba(0,0,0,0)');
    ctx.beginPath(); ctx.moveTo(toX(0), H);
    diffs.forEach(function(v,i){ ctx.lineTo(toX(i), toY(v)); });
    ctx.lineTo(toX(diffs.length-1), H); ctx.closePath(); ctx.fillStyle = grad; ctx.fill();
    ctx.strokeStyle = lineColor; ctx.lineWidth = 2.5; ctx.lineJoin = 'round'; ctx.beginPath();
    diffs.forEach(function(v,i){ i===0 ? ctx.moveTo(toX(i),toY(v)) : ctx.lineTo(toX(i),toY(v)); });
    ctx.stroke();
    var lx = toX(diffs.length-1); var ly = toY(diffs[diffs.length-1]);
    ctx.beginPath(); ctx.arc(lx, ly, 5, 0, Math.PI*2); ctx.fillStyle = lineColor; ctx.fill();
}

function loadOILog() {
    var url = 'oi_log.json?_t=' + Date.now();
    fetch(url, {cache:'no-store'})
        .then(function(r){ if (!r.ok) throw new Error('HTTP ' + r.status); return r.json(); })
        .then(function(data) {
            if (Array.isArray(data) && data.length > 0) {
                data[0]._isLive = true;
                _oiData = data;
                window._oiData = data;
                renderOITable(data);
                var now = new Date(new Date().toLocaleString('en-US',{timeZone:'Asia/Kolkata'}));
                var el  = document.getElementById('oiLastFetch');
                if (el) el.textContent = 'Last fetch: ' + String(now.getHours()).padStart(2,'0') + ':' + String(now.getMinutes()).padStart(2,'0') + ':' + String(now.getSeconds()).padStart(2,'0') + ' IST';
            }
        })
        .catch(function(e) {
            var tbody = document.getElementById('oiTableBody');
            if (tbody) tbody.innerHTML = '<tr><td colspan="12" class="oi-empty-state">&#9888; Could not load oi_log.json</td></tr>';
        });
}

window.addEventListener('load', function(){
    if (window.location.hash === '#oi-trend') { switchTab('oi-trend'); }
    else { loadOILog(); }
});

setInterval(loadOILog, 30000);
window.addEventListener('resize', function(){
    if (_oiData.length > 0) drawSparkline(filterByInterval(_oiData, _oiInterval));
});
</script>

<script>

/* ════════════════════════════════════════════════════════════════
   NIFTY 50 HEATMAP — client-side rendering engine
   Data loaded from embedded JSON, refreshed on silent page reload
   ════════════════════════════════════════════════════════════════ */
(function() {
    var _hmIndex = 'nifty';

    function getColor(pct) {
        var capped = Math.max(-3, Math.min(3, pct));
        if (pct === 0) return { bg: 'rgba(55,65,81,0.8)', border: 'rgba(100,116,139,0.4)', text: '#94a3b8' };
        if (pct > 0) {
            var intensity = Math.min(1, pct / 2.5);
            var r = Math.round(0   + (0   - 0)   * intensity);
            var g = Math.round(180 + (230 - 180) * intensity);
            var b = Math.round(80  + (118 - 80)  * intensity);
            var a = 0.25 + intensity * 0.55;
            return {
                bg:     'rgba(' + r + ',' + g + ',' + b + ',' + a + ')',
                border: 'rgba(' + r + ',' + g + ',' + b + ',0.5)',
                text:   pct > 1.5 ? '#fff' : '#a7f3d0'
            };
        } else {
            var intensity = Math.min(1, Math.abs(pct) / 2.5);
            var r = Math.round(220 + (239 - 220) * intensity);
            var g = Math.round(50  + (68  - 50)  * intensity);
            var b = Math.round(50  + (68  - 50)  * intensity);
            var a = 0.25 + intensity * 0.55;
            return {
                bg:     'rgba(' + r + ',' + g + ',' + b + ',' + a + ')',
                border: 'rgba(' + r + ',' + g + ',' + b + ',0.5)',
                text:   Math.abs(pct) > 1.5 ? '#fff' : '#fca5a5'
            };
        }
    }

    function renderHeatmap() {
    var el = document.getElementById('hmDataScript');
    var grid = document.getElementById('hmGrid');
    if (!el || !grid) {
        console.warn('HM: elements missing after refresh');
        return;
    }
    var rawText = el.textContent || el.innerHTML || el.innerText || '';
    if (!rawText || rawText.trim() === '') {
        console.warn('HM: empty data script');
        return;
    }
    var data;
    try { data = JSON.parse(rawText); }
    catch(e) { console.warn('HM parse error:', e); return; }

        var html = '';
        data.forEach(function(s) {
            var c    = getColor(s.change_pct);
            var sign = s.change_pct >= 0 ? '+' : '';
            var hwBorder = s.high_wt ? '2px solid rgba(79,195,247,0.6)' : ('1px solid ' + c.border);
            var priceStr = s.price > 0 ? '₹' + s.price.toLocaleString('en-IN') : '—';
            html += '<div class="hm-cell" style="background:' + c.bg + ';border:' + hwBorder + ';color:' + c.text + ';"'
                  + ' title="' + s.symbol + ' | Prev: ₹' + s.prev_close + ' | Price: ₹' + s.price + ' | Chg: ' + sign + s.change_pct + '%">'
                  + '<div class="hm-cell-sym">' + s.symbol + '</div>'
                  + '<div class="hm-cell-price">' + priceStr + '</div>'
                  + '<div class="hm-cell-chg">' + sign + s.change_pct.toFixed(2) + '%</div>'
                  + '</div>';
        });
        grid.innerHTML = html;

        // Update breadth counters
        var adv = data.filter(function(s){ return s.change_pct > 0; }).length;
        var dec = data.filter(function(s){ return s.change_pct < 0; }).length;
        var neu = data.filter(function(s){ return s.change_pct === 0; }).length;
        var e;
        e = document.getElementById('hmAdvCount'); if(e) e.textContent = adv;
        e = document.getElementById('hmDecCount'); if(e) e.textContent = dec;
        e = document.getElementById('hmNeuCount'); if(e) e.textContent = neu;

        // Update mover table
        // Update mover table — fixed Nifty weight order
        var WEIGHT_ORDER = [
            "RELIANCE","HDFCBANK","ICICIBANK","INFY","TCS",
            "BHARTIARTL","LT","AXISBANK","KOTAKBANK","SBIN"
        ];
        var hwLookup = {};
        data.forEach(function(s){ if(s.high_wt) hwLookup[s.symbol] = s; });
        var hwStocks = WEIGHT_ORDER.map(function(sym){ return hwLookup[sym]; }).filter(Boolean);
        var moverBody = document.getElementById('hmMoverBody');
        if (moverBody) {
            var mhtml = '';
            hwStocks.forEach(function(s) {
                var col  = s.change_pct >= 0 ? '#00e676' : '#ff5252';
                var sign = s.change_pct >= 0 ? '+' : '';
                mhtml += '<tr>'
                       + '<td class="hm-mover-sym">' + s.symbol + '</td>'
                       + '<td class="hm-mover-prev">₹' + s.prev_close.toLocaleString('en-IN') + '</td>'
                       + '<td class="hm-mover-price">₹' + s.price.toLocaleString('en-IN') + '</td>'
                       + '<td class="hm-mover-chg" style="color:' + col + ';">' + sign + s.change_pct.toFixed(2) + '%</td>'
                       + '</tr>';
            });
            moverBody.innerHTML = mhtml;
        }

        drawDonut(adv, dec, neu);
    }

    function drawDonut(adv, dec, neu) {
        var canvas = document.getElementById('hmDonutCanvas');
        if (!canvas || !canvas.getContext) return;
        var ctx = canvas.getContext('2d');
        var cx = 55, cy = 55, r = 40, lw = 10;
        ctx.clearRect(0, 0, 110, 110);
        var total = adv + dec + neu || 1;
        var slices = [
            { val: adv, color: '#00e676' },
            { val: dec, color: '#ef4444' },
            { val: neu, color: '#546e7a' },
        ];
        var start = -Math.PI / 2;
        slices.forEach(function(sl) {
            if (!sl.val) return;
            var sweep = (sl.val / total) * 2 * Math.PI;
            ctx.beginPath();
            ctx.arc(cx, cy, r, start, start + sweep);
            ctx.strokeStyle = sl.color;
            ctx.lineWidth = lw;
            ctx.stroke();
            start += sweep;
        });
        // center text handled by CSS overlay
    }

    /* ── OI Chart from oi_log.json ────────────────────────────── */
    function drawHMOIChart(data) {
        var canvas = document.getElementById('hmOICanvas');
        if (!canvas || !canvas.getContext) return;
        var ctx = canvas.getContext('2d');
        var W = canvas.parentElement ? canvas.parentElement.clientWidth - 32 : 420;
        var H = 200;
        canvas.width = W; canvas.height = H;
        ctx.clearRect(0, 0, W, H);
        if (!data || data.length < 2) {
            ctx.fillStyle = 'rgba(128,222,234,0.2)';
            ctx.font = '11px JetBrains Mono, monospace';
            ctx.textAlign = 'center';
            ctx.fillText('Loading OI data…', W/2, H/2);
            return;
        }
        var reversed = data.slice().reverse();
        var ceArr    = reversed.map(function(r){ return r.call_oi_chg || 0; });
        var peArr    = reversed.map(function(r){ return r.put_oi_chg  || 0; });
        var allVals  = ceArr.concat(peArr);
        var minV = Math.min.apply(null, allVals);
        var maxV = Math.max.apply(null, allVals);
        var range = (maxV - minV) || 1;
        var pad = 14;
        function toX(i) { return (i / (ceArr.length - 1)) * (W - 2*pad) + pad; }
        function toY(v) { return H - ((v - minV) / range) * (H - 2*pad) - pad; }

        // Zero line
        ctx.save();
        ctx.strokeStyle = 'rgba(79,195,247,0.12)';
        ctx.lineWidth = 1;
        ctx.setLineDash([4, 4]);
        var zy = toY(0);
        ctx.beginPath(); ctx.moveTo(pad, zy); ctx.lineTo(W-pad, zy); ctx.stroke();
        ctx.restore();

        // Draw CE (red)
        ctx.strokeStyle = '#ef4444'; ctx.lineWidth = 2; ctx.lineJoin = 'round';
        ctx.beginPath();
        ceArr.forEach(function(v, i){ i===0 ? ctx.moveTo(toX(i),toY(v)) : ctx.lineTo(toX(i),toY(v)); });
        ctx.stroke();

        // Draw PE (green)
        ctx.strokeStyle = '#10b981'; ctx.lineWidth = 2; ctx.lineJoin = 'round';
        ctx.beginPath();
        peArr.forEach(function(v, i){ i===0 ? ctx.moveTo(toX(i),toY(v)) : ctx.lineTo(toX(i),toY(v)); });
        ctx.stroke();

        // Time labels on x-axis (every ~5th point)
        ctx.fillStyle = 'rgba(128,222,234,0.3)';
        ctx.font = '8px JetBrains Mono, monospace';
        ctx.textAlign = 'center';
        var step = Math.max(1, Math.floor(reversed.length / 6));
        for (var i = 0; i < reversed.length; i += step) {
            ctx.fillText(reversed[i].time || '', toX(i), H - 2);
        }
    }

    window.setHMIndex = function(idx, btn) {
        _hmIndex = idx;
        document.querySelectorAll('.hm-idx-btn').forEach(function(b){ b.classList.remove('active'); });
        btn.classList.add('active');
        // Re-draw with same data (different index would need separate fetch)
        if (window._oiData && window._oiData.length) drawHMOIChart(window._oiData);
    };

    /* Called on tab switch or page load */
    window.renderHeatmap = renderHeatmap;

    window.addEventListener('load', function() {
    setTimeout(renderHeatmap, 100);
    setTimeout(renderHeatmap, 500);
    setTimeout(renderHeatmap, 1500);
    setTimeout(function() {
        if (window._oiData && window._oiData.length) drawHMOIChart(window._oiData);
    }, 800);
});

    // Hook into loadOILog to also refresh OI chart
    var _origRenderOI = window.renderOITable;

    /* After oi_log loads, also draw heatmap OI chart */
    var _origLoad = window.loadOILog;
    function patchedLoadOILog() {
        fetch('oi_log.json?_t=' + Date.now(), {cache:'no-store'})
            .then(function(r){ return r.json(); })
            .then(function(data) {
                if (Array.isArray(data) && data.length) {
                    window._oiData = data;
                    drawHMOIChart(data);
                    var pcr = data[0] && data[0].pcr ? data[0].pcr : null;
                    var el = document.getElementById('hmOIPCR');
                    if (el && pcr) el.textContent = 'PCR: ' + pcr;
                }
            })
            .catch(function(){});
    }

    // Run OI chart draw periodically
    setInterval(function() {
    patchedLoadOILog();
    renderHeatmap();
}, 30000);

// Initial draw
setTimeout(patchedLoadOILog, 1200);
setTimeout(renderHeatmap, 800);
setTimeout(renderHeatmap, 2000);
})();

</script>

</body></html>